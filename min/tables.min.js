let tableElement=document.getElementById('tables-table'),tablesTable={name:"Table",headers:["Column 1","Column 2","Column 3"],data:[{"Column 1":"","Column 2":"","Column 3":""},{"Column 1":"","Column 2":"","Column 3":""},{"Column 1":"","Column 2":"","Column 3":""}]},initialTablesTable=JSON.stringify(tablesTable);initializeTablesApp();function showTablesDiv(a){updateDataFromCurrentInputs(tablesTable);let b=document.getElementsByClassName('tables-div');for(let a of b)a.style.display="none";document.getElementById(a).style.display="unset"}function initializeTablesApp(){makeTable(JSON.parse(initialTablesTable)),updateDataFromCurrentInputs(tablesTable),showTablesDiv('tables-tables-table')}function backupTablesTable(){return updateDataFromCurrentInputs(tablesTable),JSON.parse(JSON.stringify(currentTablesTable))}function processColumnClick(a){updateDataFromCurrentInputs(tablesTable),populateMoveColumnSelect(tablesTable),document.getElementById("tables-current-header").innerHTML=a,document.getElementById("tables-new-header-name").value=a,showTablesDiv("tables-tables-header-form")}function processRowClick(a){updateDataFromCurrentInputs(tablesTable),populateMoveRowSelect(tablesTable),document.getElementById("tables-current-row").innerHTML=a.toString(),showTablesDiv("tables-tables-row-form")}function makeTable(d){let a="";a="";let b=d.headers;a+="<thead><tr><th></th>";for(let c=0;c<b.length;c++)a+="<th id='"+b[c]+"' onclick=\"processColumnClick('"+b[c]+"');\">"+b[c].replace(/</g,"&lt;").replace(/>/g,"&gt;"),+"</th>";a+="<th id='add-column' onclick='addColumn(tablesTable)'>+</th>",a+="</tr></thead>";let f=a;a="<tbody>";let c=d.data;console.log("bodyData"),console.log(c);let g=c.length;for(let d=0;d<g;d++){a+="<tr><td class='tables-table-row-number' onclick='processRowClick("+d.toString()+")'>"+d.toString()+"</td>";let e=b.length;console.log(e);for(let f=0;f<e;f++)c[d][b[f]]===void 0&&(c[d][b[f]]="input read error"),a+="<td><input type='text' id='cell-"+d.toString()+"-"+f.toString()+"' value='"+c[d][b[f]].toString()+"'></td>";a+="</tr>"}a+="</tbody>";let h=a;a="<tfoot><tr><th id='add-row' onclick='addRow(tablesTable)'>+</th>";for(let c=0;c<b.length;c++)a+="<th id='footer-"+(c+1).toString()+"' onclick=\"processColumnClick('"+b[c]+"');\"></th>";a+="</tr></tfoot>";let i=a,e=f+h+i;return populateMoveColumnSelect(d),populateMoveRowSelect(d),tableElement.innerHTML=e,e}function populateMoveColumnSelect(b){let a=document.getElementById('move-column');a.options.length=0;let c=b.headers;for(th of c){let b=document.createElement('option');b.value=th,b.text=th,a.add(b)}}function populateMoveRowSelect(b){let a=document.getElementById('move-row');a.options.length=0;for(let c=0;c<b.data.length;c++){let d=document.createElement('option');d.value=c.toString(),d.text=c.toString(),a.add(d)}}function updateDataFromCurrentInputs(a){let b=a.headers;console.log("headers"),console.log(b);for(let c=0;c<a.data.length;c++)for(let d=0;d<a.headers.length;d++){let e="cell-"+c.toString()+"-"+d.toString(),f=document.getElementById(e);a.data[c][b[d]]=f.value}}function updateHeaderName(){let b=document.getElementById("tables-current-header").innerHTML,a=document.getElementById('tables-new-header-name').value;if(b===a){makeTable(tablesTable);return}if(a==="")if(a=prompt("There is no name listed, please enter the new name"),a===null)return;tablesTable=_changeHeaderAndDataPropertyName(tablesTable,a,b),makeTable(tablesTable),showTablesDiv('tables-tables-table')}function tablesSort(a){let b=document.getElementById("tables-current-header").innerHTML;sortTablesByField(b,a)}function sortTablesByField(a,b=1){confirm("Sort by "+a+"?\n\nThis is destructive and irreversible.")&&(destructiveSort(tablesTable.data,a,b),makeTable(tablesTable),showTablesDiv('tables-tables-table'))}function _changeHeaderAndDataPropertyName(a,b,d){let c=a.data;b=getBestName(a,b);let e=a.headers.indexOf(d);a.headers[e]=b;for(let a=0;a<c.length;a++)c[a][b]=c[a][d],delete c[a][d];return a}function deleteColumn(){let a=document.getElementById("tables-current-header").innerHTML;if(confirm("Are you sure? \n\nDelete Column: "+a+"?")){let b=tablesTable.headers.indexOf(a);tablesTable.headers.splice(b,1);for(let b=0;b<tablesTable.data.length;b++)delete tablesTable.data[b][a];makeTable(tablesTable),showTablesDiv('tables-tables-table')}}function addColumn(a){updateDataFromCurrentInputs(a);let b=1,c="new"+b.toString();while(a.headers.includes(c))console.log("column name already in use"),b+=1,c="new"+b.toString();a.headers.push(c),fillInEmptyPropertyValues(a),makeTable(a)}function moveColumn(){let a=document.getElementById("tables-current-header").innerHTML,b=document.getElementById("move-column").value;if(a===b){console.log("destination is same as source");return}let c=tablesTable.headers.indexOf(a),d=tablesTable.headers.indexOf(b),e=tablesTable.headers.splice(c,1)[0];tablesTable.headers.splice(d,0,e),makeTable(tablesTable),showTablesDiv('tables-tables-table')}function getBestName(d,b){let e=d.headers,c=0,a=b;while(e.includes(a))console.log("column name already in use"),c+=1,a=b+"-"+c.toString();return a}function copyColumn(){let a=document.getElementById("tables-current-header").innerHTML,b=getBestName(tablesTable,a);tablesTable.headers.push(b);for(let c=0;c<tablesTable.data.length;c++)tablesTable.data[c][b]=tablesTable.data[c][a];makeTable(tablesTable),showTablesDiv('tables-tables-table')}function calculateTotal(){let b=document.getElementById("tables-current-header").innerHTML,a=0;for(let c of tablesTable.data)a=a+Number(c[b]);confirm("The total is: "+a.toString()+"\nCopy to clipboard?")&&copyToClipBoard(a.toString()),showTablesDiv('tables-tables-table')}function tablesCancel(){console.log("tablesCancel called"),makeTable(tablesTable),showTablesDiv('tables-tables-table')}function calculateAverage(){alert("calculate average called"),console.log("calcualtoe average called");let c=document.getElementById("tables-current-header").innerHTML,a=0;for(let b of tablesTable.data)a=a+Number(b[c]);let b=a/tablesTable.data.length;confirm("The average is: "+b.toString()+"\nCopy to clipboard?")&&copyToClipBoard(b.toString()),showTablesDiv('tables-tables-table')}function addRow(a){let c=a.headers;updateDataFromCurrentInputs(a);let d=a.headers.length,b={};for(let a=0;a<d;a++)b[c[a]]="";a.data.push(b),makeTable(a)}function deleteRow(){let a=parseInt(document.getElementById("tables-current-row").innerHTML),b=tablesTable.data;b.splice(a,1),makeTable(tablesTable),showTablesDiv('tables-tables-table')}function copyRow(){console.log("copy row called");let b=parseInt(document.getElementById("tables-current-row").innerHTML),a=tablesTable.data;console.log(a);let c=JSON.parse(JSON.stringify(tablesTable.data[b]));a.push(c),makeTable(tablesTable),showTablesDiv('tables-tables-table')}function moveRow(){console.log("move row called");let b=parseInt(document.getElementById("tables-current-row").innerHTML),a=tablesTable.data,c=parseInt(document.getElementById("move-row").value),d=a.splice(b,1)[0];a.splice(c,0,d),makeTable(tablesTable),showTablesDiv('tables-tables-table')}function tablesNewTable(){confirm("Are you sure?  This will erase all current data.")&&initializeTablesApp()}function tablesLoad(){console.log("tablesLoad() called");let b="",a=document.createElement('input');a.type="file",a.accept=".csv",a.addEventListener("change",function(){let d=a.files[0],c=new FileReader;c.onload=function(a){b=a.target.result,confirm("Use the first line as the header row?")?tablesTable=csvToJSON(b,!0):tablesTable=csvToJSON(b,!0),makeTable(tablesTable)},c.readAsText(d,"UTF-8")}),a.click()}function tablesSave(){console.log("tablesSave() called"),updateDataFromCurrentInputs(tablesTable),confirm("Include header as first line in csv file?")?saveStringToTextFile(makeCSV(tablesTable,!0),"csvTable"+getTodaysDate(),".csv"):saveStringToTextFile(makeCSV(tablesTable,!1),"csvTable"+getTodaysDate(),".csv")}function tablesCopyCSVToClipboard(){updateDataFromCurrentInputs(tablesTable);let a="";return confirm("Include header as first line?")?a=copyToClipBoard(makeCSV(tablesTable,!0)):a=copyToClipBoard(makeCSV(tablesTable,!1)),a}