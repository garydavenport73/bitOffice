let textarea=document.getElementById("text-editor"),documentDiv=document.getElementById('document-result'),remSize=1,marginSize=2,writeUndos=[],writeUndosCursor=0,compareWriteData="";initializeWriteApp();let lastTextAreaText=textarea.value;function initializeWriteApp(){documentDiv.style.fontSize=remSize+"rem",documentDiv.style.marginLeft=marginSize+"rem",documentDiv.style.marginRight=marginSize+"rem",writeUndos.push(textarea.value),writeUpdateResult(),textarea.spellcheck=!1,textarea.focus(),document.getElementById('text-editor').addEventListener('keydown',function(a){a.key=='Tab'&&(a.preventDefault(),insertTab(this),updateUndosIfTextChanges())}),document.getElementById('text-editor').addEventListener('input',updateUndosIfTextChanges),compareWriteData=makeCompareWriteData()}function updateUndosIfTextChanges(){console.log("called"),console.log(writeUndos),lastTextAreaText!=textarea.value&&(addUndo(),lastTextAreaText=textarea.value),console.log(writeUndos)}function insertTab(a){let b=a.selectionStart,c=a.selectionEnd;a.value=a.value.substring(0,b)+"	"+a.value.substring(c),a.selectionStart=a.selectionEnd=b+1,writeUpdateResult()}function exportToHTML(){let a=serializeElementToPage("document-parent","html,#document-result,#document-parent{background-color:white;}");copyToClipBoard(a),confirm("HTML document exported to clipboard.\n\nWould you like to export to HTML file?")&&saveStringToTextFile(a,'write'+getTodaysDate(),'.html')}function newDocument(){confirm("This will overwrite current document.")&&writeResetAll()}function writeResetAll(){writeBaseFilename="",remSize=1,marginSize=2,textarea.value="",documentDiv.style.textAlign="left",documentDiv.style.fontFamily="Georgia, 'Times New Roman', Garamond, Times, serif",documentDiv.style.fontSize="1rem",documentDiv.style.marginLeft="2rem",textarea.spellcheck=!1,writeUndos=[],writeUndos.push(textarea.value),writeUpdateResult(),textarea.focus()}function makeCompareWriteData(){writeUpdateResult();let a={};return a.text=textarea.value,a.textAlign=documentDiv.style.textAlign,a.fontFamily=documentDiv.style.fontFamily,a.fontSize=documentDiv.style.fontSize,a.marginSize=documentDiv.style.marginLeft,a.spellCheck=textarea.spellcheck,JSON.stringify(a)}function writeDataToJSON(){writeUpdateResult();let a={};a.text=textarea.value,a.textAlign=documentDiv.style.textAlign,a.fontFamily=documentDiv.style.fontFamily,a.fontSize=documentDiv.style.fontSize,a.marginSize=documentDiv.style.marginLeft,a.spellCheck=textarea.spellcheck,writeBaseFilename="write"+getTodaysDate();let b=JSON.stringify(a);saveStringToTextFile(b,writeBaseFilename,".json"),compareWriteData=makeCompareWriteData()}function writeLoad(){console.log("writeLoad() called"),console.log(textarea.value),console.log(textarea.value.length);let a=!0;if(textarea.value.length!=0&&(a=confirm("This will overwrite current document")),a){let b="",a=document.createElement('input');a.type="file",a.accept=".json",a.addEventListener("change",function(){let d=a.files[0],c=new FileReader;c.onload=function(c){b=c.target.result;let a=JSON.parse(b);textarea.value=a.text,documentDiv.style.textAlign=a.textAlign,documentDiv.style.fontFamily=a.fontFamily,documentDiv.style.fontSize=a.fontSize,documentDiv.style.marginLeft=a.marginSize,textarea.spellcheck=a.spellCheck,writeUpdateResult(),remSize=parseFloat(a.fontSize.split("rem")[0]),marginSize=parseFloat(a.marginSize.split("rem")[0]),writeUndos=[],console.log("writeUndos length",writeUndos.length),writeUndos.push(textarea.value),textarea.focus()},c.readAsText(d,"UTF-8")}),a.click()}}function addUndo(){if(console.log(writeUndos.length,writeUndosCursor),console.log(writeUndos),writeUndos.length-1===writeUndosCursor)console.log("we are at end"),writeUndos.length>=316?(writeUndos.shift(),writeUndos.push(textarea.value)):(writeUndos.push(textarea.value),writeUndosCursor+=1),console.log(writeUndos);else{console.log("we are not at end"),console.log(writeUndos);let a=writeUndos.length-(writeUndosCursor+1);writeUndos=writeUndos.slice(0,-a),console.log(writeUndos),writeUndos.push(textarea.value),writeUndosCursor+=1,console.log(writeUndos)}}function backUndo(){if(console.log("back Undo called"),console.log(writeUndos),console.log(writeUndosCursor),writeUndosCursor>0){let a=writeUndos[writeUndosCursor-1];textarea.value=a,writeUpdateResult(),writeUndosCursor=writeUndosCursor-1}console.log(writeUndos),console.log(writeUndosCursor)}function writeRedo(){if(console.log("redo called"),writeUndos.length-1===writeUndosCursor)console.log("we are at end");else{console.log("we are not at end"),writeUndosCursor+=1;let a=writeUndos[writeUndosCursor];textarea.value=a,writeUpdateResult()}}function processSelectedText(g){let a=g.innerHTML;console.log(a),a==="⇚"?documentDiv.style.textAlign="left":a==="⇛⇚"?documentDiv.style.textAlign="center":a==="⇛"?documentDiv.style.textAlign="right":a==="Mono"?documentDiv.style.fontFamily="'Courier New', Courier, monospace":a==="Serif"?documentDiv.style.fontFamily="Georgia, 'Times New Roman', Garamond, Times, serif":a==="Sans"?documentDiv.style.fontFamily="Arial, Verdana, Helvetica, Tahoma, sans-serif":a==="<sub>A</sub>A"?(remSize=remSize+.2,documentDiv.style.fontSize=remSize.toString()+"rem"):a==="<sup>A</sup>A"?(remSize=remSize-.2,documentDiv.style.fontSize=remSize.toString()+"rem"):a==="⇥⇤"?(marginSize=marginSize+1,marginSize>20&&(marginSize=20),documentDiv.style.marginLeft=marginSize.toString()+"rem",documentDiv.style.marginRight=marginSize.toString()+"rem"):a==="⇤⇥"?(marginSize=marginSize-1,marginSize<0&&(marginSize=0),documentDiv.style.marginLeft=marginSize.toString()+"rem",documentDiv.style.marginRight=marginSize.toString()+"rem"):a==="⟲"?backUndo():a==="✓"&&(console.log(textarea.spellcheck),textarea.spellcheck=!textarea.spellcheck,console.log(textarea.spellcheck),textarea.focus());let f=textarea.value.length,d=textarea.selectionStart,e=textarea.selectionEnd,c=textarea.value.substring(d,e),b=c;a==="<b>B</b>"?b='<b>'+c+'</b>':a==="<u>U</u>"?b='<u>'+c+'</u>':a==="<em>I</em>"?b='<em>'+c+'</em>':a==="H1"?b='<h1>'+c+'</h1>':a==="H2"?b='<h2>'+c+'</h2>':a==="H3"?b='<h3>'+c+'</h3>':a==="¶"?b='<p>'+c+'</p>':a==="―"?b='<hr>'+c:a==="•"?b='&bullet; '+c:a==="↹"&&(b="	"+c),textarea.value=textarea.value.substring(0,d)+b+textarea.value.substring(e,f),writeUpdateResult(),textarea.selectionStart=d+b.length,textarea.selectionEnd=d+b.length,textarea.focus(),a!="⟲"&&updateUndosIfTextChanges()}function writeUpdateResult(){let a=document.getElementById('text-editor').value;document.getElementById('document-result').innerHTML=a.split('\n').join('<br>'),textarea.spellcheck===!0?document.getElementById("spell-check").style.color="green":document.getElementById("spell-check").style.color="red"}function printDiv(b){let f=new XMLSerializer(b),c=new XMLSerializer,d=document,e=c.serializeToString(d.getElementById(b));var a=window.open('','');a.document.write('<html>'),a.document.write("<style> #document-result {overflow-wrap: break-word;width: auto;white-space: pre-wrap;} </style>"),a.document.write(e),a.document.write('</body></html>'),a.document.close(),a.print()}