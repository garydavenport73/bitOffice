<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><style>html{box-sizing:border-box;font-size:16px}*,*:before,*:after{box-sizing:inherit}body,h1,h2,h3,h4,h5,h6,p,ol,ul{margin:0;padding:0;font-weight:400}ol,ul{list-style:none}img{max-width:100%;height:auto}html{background-color:#f0f8ff}h1:not(#document-result h1){color:#e6e6fa;background-color:#0000cd;font-family:Arial,Helvetica,sans-serif;font-size:32px;font-weight:700;padding:2px}#top-nav{color:#fff;background-color:#0000cd;padding-bottom:2px}#top-nav button{font-size:1.4rem;padding:5px;margin:1px;min-height:25px;background-color:#e0e0e0;border:#e0e0e0;border-radius:5px}h2:not(#document-result h2){margin:16px;font-weight:700;text-align:center;padding:2px;border-radius:5px;font-family:Arial,Helvetica,sans-serif;border:1px solid grey}#main-planner h2{color:#000;background-color:orange}#main-notes h2{background-color:orange;color:#000}#main-write h2{background-color:#5f9ea0}#main-tables h2{background-color:#228b22;color:#faebd7}#main-write h2{background-color:#5f9ea0;color:#faebd7}#main-calculator h2{background-color:dimgrey;color:snow}#document-result h1,#document-result h2,#document-result h3,#document-result h4{background-color:unset;color:unset}#document-result *{background-color:unset;width:unset;text-align:unset;border-radius:unset;margin-left:unset;margin-right:unset;width:unset;padding-bottom:unset;align-items:unset;border-radius:unset;margin:unset;padding:unset}#document-parent{margin:0;padding:0;width:100%;background-color:#fafad2}#document-result{overflow-wrap:break-word;min-height:100px;width:auto;background-color:#fafad2;white-space:pre-wrap}main{background-color:#e0e0e0}body{width:320px;background-color:#87cefa;background-color:#e0e0e0;margin:auto;padding:5px;box-sizing:border-box}h1:not(#document-result h1),h2:not(#document-result h2),h3:not(#document-result h3),nav{display:flex;flex-direction:row;justify-content:center}#edit-bar,#document-settings{display:flex;justify-content:left;flex-wrap:wrap;background-color:#5f9ea0;border:1px solid #000;margin:0;padding:0}#edit-bar button,#document-settings button{border-radius:5px;background-color:#e0e0e0;border:1px solid grey;padding:1px 4px;margin:0}#text-editor{width:100%;max-width:100%;overflow-wrap:break-word;min-height:100px;margin-top:0;margin-bottom:0}footer{position:fixed;bottom:0;left:50%;transform:translate(-50%,0%)}button{padding:5px}#main-planner,#main-notes,#main-write,#main-tables,#main-calculator{display:flex;flex-direction:column}main{min-height:320px}#planner-contacts-form *,#planner-calendar-form *{width:100%;display:auto;box-sizing:border-box}#planner-planner-help ul li,#tables-help ul li{list-style-position:inside;list-style-type:disc;margin:0 15px}#planner-planner-help ol li,#tables-help ol li{list-style-position:inside;list-style-type:decimal;margin:0 15px}#planner-planner-help p,#tables-help p{margin:15px}#planner-help,#tables-help pre{font-size:12px}.table-container table,.table-container table td,.table-container table th{border:1px solid #000;border-collapse:collapse}.table-container pre{white-space:pre-wrap;font-size:12px;word-break:break-all}.table-container table{box-sizing:border-box;margin:auto;width:100%}#contacts-table th,#contacts-table td,#calendar-table th,#calendar-table td{display:none}#calendar-table th:nth-of-type(1),#calendar-table th:nth-of-type(3),#calendar-table th:nth-of-type(6),#calendar-table td:nth-of-type(1),#calendar-table td:nth-of-type(3),#calendar-table td:nth-of-type(6){display:table-cell}#contacts-table td:nth-of-type(1),#contacts-table th:nth-of-type(1),#contacts-table th:nth-of-type(4),#contacts-table td:nth-of-type(4){display:table-cell}#contacts-table th:nth-of-type(3),#contacts-table td:nth-of-type(3){display:table-cell}#calendar-container{margin:10px;display:flex;flex-direction:column;align-items:center}#special-calendar{background-color:snow;font-family:Arial,Verdana,Helvetica,Tahoma,sans-serif;font-size:16px;padding:0;margin:0;background-color:#fff}#special-calendar table td{height:32px;text-align:center;width:32px}#special-calendar{border:1px solid grey;width:240px}#month-chooser{background-color:#f5f5f5;min-height:30px;border-radius:5px;width:240px;text-align:center;font-family:Arial,Helvetica,sans-serif;font-size:16px}#calendar-date{display:none}main h3{background-color:#e0e0e0}.nested-menu:hover{color:snow;background-color:grey}#tables-table th:hover:not(:first-of-type),#tables-table td:first-of-type:hover{background-color:#fff}#add-row:hover,#add-column:hover{background-color:#fff}#add-column{min-width:1rem}.table-container{display:block;overflow-x:auto;margin-left:auto;margin-right:auto;width:100%;text-align:center}#tables-table input{width:100%;border:none}#tables-table input:hover{background-color:lightgrey}#tables-table td{padding:0}#tables-table th:not(:last-of-type){min-width:3rem}#tables-table th:first-of-type{min-width:1rem}#tables-table{border:none}#tables-table th{border:none}.tables-table-row-number{border:none!important}#tables-table{background-color:lightgrey}#tables-table-table{}#tables-tables-header-form>div,#tables-tables-row-form>div{display:flex;flex-direction:column;text-align:center;width:50%;margin:auto}#tables-tables-header-form *,#tables-tables-row-form *{text-align:center}#tables-tables-header-form>div>div,#tables-tables-row-form>div>div{margin:5px 0}#tables-tables-header-form>div>div>*,#tables-tables-row-form>div>div>*{width:100%}#calculator-table{width:100%;min-width:0%}#calculator-table td button{font-size:2rem;width:100%;height:4rem}.special-calculator-button{background-color:#fc3;border:1px solid grey}#last-calculator-expression{overflow-wrap:anywhere;min-height:18px;color:grey}#calculator-input{width:100%;height:40px;font-size:1.4rem;text-align:right}#calc-clr button{width:50%;font-size:1.4rem;padding:5px}main nav button{background-color:#e0e0e0;border:1px solid grey;border-radius:3px}</style><link id="favicon-link" rel="icon" type="image/x-icon" href="">
<title>bitOffice</title>
</head>

<body>
    <h1 onclick="alert(license);">bitOffice</h1>
    <nav id="top-nav">
        <button onclick="showMain('main-planner');">&#9742;&#128197;</button>
        <button onclick="showMain('main-notes');">&#128196;</button>
        <button onclick="showMain('main-write');">&#128221;</button>
        <button onclick="showMain('main-tables');">&#9638;</button>
        <button onclick="showMain('main-calculator');">&#128290;</button>
        <button onclick="saveSelf()">&darr;</button>
    </nav><main id="main-planner">
    <h2>Planner</h2>
    <nav id="back-home-nav">
            <button onclick="backHomePlanner();">&larr;Back to Main</button>
        </nav>
    <nav id="planner-ribbon">
        <!-- <button onclick="showPlannerDiv('planner-startup');">&#128194;</button>
            <button onclick="showPlannerDiv('planner-contacts-table');">&#9742;</button>
            <button onclick="showPlannerDiv('planner-calendar-start');makeCalendar();">&#128197;</button>
            <button onclick="showPlannerDiv('planner-planner-help');">?</button> -->
        <button onclick="showPlannerDiv('planner-startup');">&#128194;</button>
        <button onclick="showPlannerDiv('planner-calendar-start');makeCalendar();">Calendar</button>
        <button onclick="showPlannerDiv('planner-contacts-table');">Contacts</button>
        <button onclick="showPlannerDiv('planner-planner-help');">?</button>
    </nav>
    <div class="planner-div" id="planner-home">
        <h3>Planner-Home</h3>
    </div>
    <div class="planner-div" id="planner-startup">
        <h3>Planner-Load/Save</h3>
        <nav>
            <button id="startup-load-button" onclick="loadCombinedDatabase()">&#128194; Load</button>
            <button id="saveButton" onclick="saveCombinedDatabase()">&#128193; Save</button>
        </nav>
    </div>
    <div class="planner-div" id="planner-planner-help">
        <h3>Planner-Help</h3>

        <p>You can:
        <ul>
            <li>Load/Save your data to its native format. This will save both the Contacts and Calendar in one file.
            </li>
            <li>You can export all contacts to a file containing vCards</li>
            <li>You can a single vCard</li>
            <li>You can export your entire calendar in vCalendar format (.ics format)</li>
            <li>You can export a single event in vCalendar format (.ics format)</li>
        </ul>
        </p>
        <p>
            Most programs like Google Calendar or Microsoft Outlook can import or export these files.
        </p>
        <hr>
        <p>
            <i>Notes on importing:</i>
        </p>

        <p>
            The program only supports a limited number of fields. When importing from a
            different program, any fields not supported will be read into the "Notes" area on Contacts and the
            "Description" area on Calendar entries. Also, photos, audio, and video are not supported.
        </p>
    </div>
    <div class="planner-div" id="planner-contacts-table">
        <h3>Planner-Contacts</h3>
        <nav>
            <!--<button onclick="processCSVClick(contactsTable);">CSV</button>-->


            <button onclick='newContactsEntry();'>+ New Contact</button>
            <nav>
                <!-- <button onclick="loadOutlookContactsCSV();">&#128194; Import CSV</button>
                    <button onclick="saveOutlookContactsCSV();">&#128193; Export CSV</button> -->
                <button onclick="importVCF();">&#128193; Import vCards</button>
                <button onclick="exportVCF();">&#128193; Export vCards</button>
                <span class="nested-menu">&lrarr;</span>
            </nav>
        </nav>

        <div id="contacts-table" class="table-container"></div>
    </div>
    <div class="planner-div" id="planner-contacts-form">
        <h3>Planner-Contacts Form</h3>
        <div id="contacts-edit-form-message"></div>
        <div id="contacts-edit-form"></div>
        <nav>
            <button onclick='saveContactsEntry();'>Save</button>
            <button onclick='deleteContactsEntry();'>Delete</button>
            <button onclick='cancelContactsEntry();'>Cancel</button>
            <button onclick='exportSingleVCard()'>Export vCard</button>
        </nav>
    </div>
    <div class="planner-div" id="planner-calendar-start">
        <h3>Planner-Calendar</h3>
        <nav>
            <!-- <button onclick="loadOutlookCSV();">&#128194; Import CSV</button>
                <button onclick="createOutlookCSV();">&#128193; Export CSV</button> -->
            <button onclick="importICSCalendar()">&#128194; Import vCalendar</button>
            <button onclick="exportICSCalendar()">&#128193; Export vCalendar</button>
            <button onclick="clearCalendar();">Clear Calendar</button>
            <span class="nested-menu">&lrarr;</span>
        </nav>

        <div id="calendar-container">
            <div><input type='date' id="calendar-date"></div>
            <input id="month-chooser" type="month">
            <div id="special-calendar"></div>
        </div>
    </div>
    <div class="planner-div" id="planner-calendar-table">
        <h3 id="calendar-table-name"></h3>
        <nav>
            <button onclick='newCalendarEntry();'>+ New Entry</button>
            <button onclick="processCalendarHome();">Back to Main Calendar</button>
            <!-- <button onclick="processCalendarCSVClick();">CSV</button> -->
        </nav>
        <div id="calendar-table" class="table-container"></div>
    </div>
    <div class="planner-div" id="planner-calendar-form">
        <h3 id="calendar-edit-form-message"></h3>
        <div id="calendar-edit-form"></div>
        <nav>
            <button onclick='saveCalendarEntry();'>Save</button>
            <button onclick='deleteCalendarEntry();'>Delete</button>
            <button onclick='cancelCalendarEntry();'>Cancel</button>
            <button onclick="exportSingleICalEvent()">Export Event</button>
        </nav>
    </div>
</main><footer onclick="alert(license)">bitOffice &copy; 2022</footer><script>let license="MIT License\n\n\
Copyright (c) 2022 Gary Davenport\n\n\
Permission is hereby granted, free of charge, to any person obtaining a copy \
of this software and associated documentation files (the \"Software\"), to deal \
in the Software without restriction, including without limitation the rights \
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell \
copies of the Software, and to permit persons to whom the Software is \
furnished to do so, subject to the following conditions:\n\n\
The above copyright notice and this permission notice shall be included in all \
copies or substantial portions of the Software.\n\n\
THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \
SOFTWARE.";function _replaceReallCommmasInCSV(contents,commaReplacement){let newContents="";let inside=-1;for(let i=0;i<contents.length;i++){let thisChar=contents.charAt(i);if(thisChar==='"'){inside=inside*-1;newContents+=thisChar;}
else if(thisChar===","){if(inside===-1){newContents+=commaReplacement;}
else{newContents+=thisChar;}}
else{newContents+=thisChar;}}
return(newContents);}
function _replaceRealNewlinesInCSV(contents,newLineReplacement){let newContents="";let inside=-1;for(let i=0;i<contents.length;i++){let thisChar=contents.charAt(i);if(thisChar==='"'){inside=inside*-1;newContents+=thisChar;}
else if(thisChar==="\n"){if(inside===-1){newContents+=newLineReplacement;}
else{newContents+=thisChar;}}
else{newContents+=thisChar;}}
return(newContents);}
function _replaceRealCommasAndRealNewlinesInCSV(contents,commaReplacement,newlineReplacement){let newContents="";let inside=-1;for(let i=0;i<contents.length;i++){let thisChar=contents.charAt(i);if(thisChar==='"'){inside=inside*-1;newContents+=thisChar;}
else if(thisChar===","){if(inside===-1){newContents+=commaReplacement;}
else{newContents+=thisChar;}}
else if(thisChar==="\n"){if(inside===-1){newContents+=newlineReplacement;}
else{newContents+=thisChar;}}
else{newContents+=thisChar;}}
return(newContents);}
function tokenMaker(intSize){let token="";let specialString="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(let i=0;i<intSize;i++){token+=specialString[Math.floor(Math.random()*specialString.length)];}
return token;}
function escapeRegExp(string){return string.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');}
function myReplaceAll(str,match,replacement){return str.replace(new RegExp(escapeRegExp(match),'g'),()=>replacement);}
function getTokenNotInString(myString,intSize=16){let token=tokenMaker(16);while(myString.indexOf(token)!==-1){token=tokenMaker(16);}
return token;}
function csvToArrays(CSVString){CSVString=CSVString.trim();let carriageReturnToken=getTokenNotInString(CSVString);CSVString=CSVString.split("\r").join(carriageReturnToken);CSVString=CSVString.split(carriageReturnToken+"\n").join("\n");let myArray=[];CSVString=CSVString.trim();let commaToken=getTokenNotInString(CSVString);CSVString=_replaceReallCommmasInCSV(CSVString,commaToken);let newlineToken=getTokenNotInString(CSVString);CSVString=_replaceRealNewlinesInCSV(CSVString,newlineToken);let lines=CSVString.split(newlineToken);for(let i=0;i<lines.length;i++){let rowArray=lines[i].split(commaToken);for(let j=0;j<rowArray.length;j++){if(rowArray[j][rowArray[j].length-1]==='"'){rowArray[j]=rowArray[j].slice(0,rowArray[j].length-1);}
if(rowArray[j][0]==='"'){rowArray[j]=rowArray[j].slice(1,rowArray[j].length);}
rowArray[j]=rowArray[j].split('""').join('"');}
myArray.push(rowArray);}
return myArray;}
function arraysToCSV(arrayOfArrays,newLineString="\n"){let CSVString="";for(let i=0;i<arrayOfArrays.length;i++){for(let j=0;j<arrayOfArrays[i].length;j++){CSVString+='"';CSVString+=arrayOfArrays[i][j].split('"').join('""');CSVString+='",'}
CSVString=CSVString.slice(0,-1)+newLineString;}
CSVString=CSVString.slice(0,-(newLineString.length));return CSVString;}
function arraysToJSON(arrayOfArrays,usingHeaders=true){let headers=[];let data=[];let table={};if(usingHeaders===true){for(let i=0;i<arrayOfArrays[0].length;i++){let header=arrayOfArrays[0][i];let index=0;while(headers.includes(header)){console.log("WARNING - Duplicate header found: "+header);index+=1;header=header+index.toString();console.log("Attempting rename to: "+header);}
headers.push(header);}}else{for(let i=0;i<arrayOfArrays[0].length;i++){headers.push("header"+i.toString());}}
if(usingHeaders===true){startRow=1;}
else{startRow=0;}
for(let i=startRow;i<arrayOfArrays.length;i++){let tempRow={};for(let j=0;j<headers.length;j++){tempRow[headers[j]]=arrayOfArrays[i][j];}
data.push(tempRow);}
table["headers"]=headers;table["data"]=data;return(table);}
function JSONToArrays(jsonObject,includeHeaders=true){let headers=jsonObject["headers"];let data=jsonObject["data"];let arrayOfArrays=[];if(includeHeaders===true){let row=[];for(let i=0;i<headers.length;i++){row.push(headers[i].toString());}
arrayOfArrays.push(row);}
for(i=0;i<data.length;i++){let row=[];for(let j=0;j<headers.length;j++){if(data[i][headers[j]]===undefined){row.push("");}
else{row.push(data[i][headers[j]].toString());}}
arrayOfArrays.push(row);}
return(arrayOfArrays);}
function unorderedJSONToArrays(jsonObject,includeHeaders=true){let newObject={};newObject["data"]=jsonObject;let headers=[];for(rowObject of jsonObject){for(const key in rowObject){if(!headers.includes(key)){headers.push(key.toString());};}}
newObject["headers"]=headers;return JSONToArrays(newObject,includeHeaders);}
function csvToJSON(csvString,usingHeaders=true){let arrays=csvToArrays(csvString);console.log(arrays);let jsonObject=arraysToJSON(arrays,usingHeaders);return jsonObject;}
function JSONToCSV(jsonObject,includeHeaders=true,newLineString="\n"){let arrays=JSONToArrays(jsonObject,includeHeaders);let csvString=arraysToCSV(arrays,newLineString);return csvString;}
function unorderedJSONToCSV(jsonObject,includeHeaders=true){let arrays=unorderedJSONToArrays(jsonObject,includeHeaders);let csvString=arraysToCSV(arrays);return csvString;}function saveStringToTextFile(str1,basename="myfile",fileType=".txt"){let filename=basename+fileType;let blobVersionOfText=new Blob([str1],{type:"text/plain",});let urlToBlob=window.URL.createObjectURL(blobVersionOfText);let downloadLink=document.createElement("a");downloadLink.style.display="none";downloadLink.download=filename;downloadLink.href=urlToBlob;document.body.appendChild(downloadLink);downloadLink.click();downloadLink.parentElement.removeChild(downloadLink);}
function copyAndSaveString(str1,basename="myfile",fileType=".txt"){copyToClipBoard(str1,false);if(confirm("Copied to clipboard, save to file also?")){saveStringToTextFile(str1,basename,fileType);}}
function saveWebsiteAsTextFile(url){let http=new XMLHttpRequest();http.timeout=2000;http.ontimeout=function(e){alert("The request timed out.");};http.open('GET',url,true);http.onreadystatechange=function(){if(http.readyState==4&&http.status==200){alert(http.responseText);console.log(http.responseText);}}
http.send();}
function saveSelf(){let docTitle=document.getElementsByTagName("title")[0].innerText;if(confirm("Duplicate and download "+docTitle+" ?")){saveStringToTextFile(selfString,docTitle+"Clone",".html");}}
function getTodaysDate(){let now=new Date();let day=("0"+now.getDate()).slice(-2);let month=("0"+(now.getMonth()+1)).slice(-2);let today=now.getFullYear()+"-"+month+"-"+day;return today;}
function getFirstDayOfThisMonthDate(){let now=new Date();let day="01";let month=("0"+(now.getMonth()+1)).slice(-2);return now.getFullYear()+"-"+month+"-"+day;}
function getLastDayOfThisMonthDate(){let now=new Date();let day=daysInThisMonth().toString();day="0"+day;day=day.slice(-2);let month=("0"+(now.getMonth()+1)).slice(-2);return now.getFullYear()+"-"+month+"-"+day;}
function daysInSomeMonth(someMonth,someYear){return new Date(someYear,someMonth+1,0).getDate();}
function daysInThisMonth(){thisDate=new Date();thisMonth=thisDate.getMonth();thisYear=thisDate.getYear();return daysInSomeMonth(thisMonth,thisYear);}
function getDayOfWeek(isoYearMonthDay){let d=new Date(isoYearMonthDay+"T00:00");return d.getDay();}
function serializeElementToPage(id,extraStyle=""){let boilerPlate1="<!DOCTYPE html><html lang='en'><head><meta charset='UTF-8'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1.0'><title></title><style>";let allStyleTags=document.getElementsByTagName('style');let styleElementContent="";for(let i=0;i<allStyleTags.length;i++){styleElementContent=allStyleTags[i].innerHTML;}
let boilerPlate2="</style></head><body>";let boilerPlate3="</body></html>";let s=new XMLSerializer();let myElement=document.getElementById(id);let str=s.serializeToString(myElement);let htmlPage=boilerPlate1+styleElementContent+extraStyle+boilerPlate2+str+boilerPlate3;console.log(htmlPage);return htmlPage;}
function simulateUndo(){document.execCommand('undo',false,null);}
function simulateRedo(){document.execCommand('redo',false,null);}
function askConfirm(){return "Did you remember to save your data?";}
function showMain(id){let mains=document.getElementsByTagName('main');for(let main of mains){main.style.display="none";}
document.getElementById(id).style.display="flex";}
function copyToClipBoard(str,message=true){let el=document.createElement('textarea');el.value=str;el.setAttribute('readonly','');el.style={position:'absolute',left:'-9999px'};document.body.appendChild(el);el.select();document.execCommand('copy');document.body.removeChild(el);if(message){alert('Copied to Clipboard.');}
return(str);}
function fillInEmptyPropertyValues(table){let data=table["data"];let headers=table["headers"];for(let i=0;i<data.length;i++){for(let j=0;j<headers.length;j++){if(data[i][headers[j]]===undefined){data[i][headers[j]]="";}}}}
function makeCSV(thisTable,saveWithHeader=true){return JSONToCSV(thisTable,saveWithHeader,"\n");}
function tokenMaker(intSize){let token="";let specialString="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let index=0;for(let i=0;i<intSize;i++){token+=specialString[Math.floor(Math.random()*specialString.length)];}
console.log(token);return token;}
function processCSVClick(table){let thisCSV="";thisCSV=makeCSV(table,true);copyToClipBoard(thisCSV);if(confirm("Table copied to CSV.\n\nSave to file also?")){copyAndSaveString(thisCSV,table["name"]+getTodaysDate(),".csv");}}
function destructiveSort(arrayOfObjects,field,direction=1){if(direction!=-1){direction=1;}
arrayOfObjects.sort((a,b)=>{if(a[field]<b[field]){return-1*direction;}
if(a[field]>b[field]){return 1*direction;}
return 0;});}
function destructiveDoubleSortAscending(arrayOfObjects,date,time){arrayOfObjects.sort((a,b)=>{if(a[date]>b[date]){return 1;}
else if(a[date]<b[date]){return-1;}
if(a[time]>b[time]){return 1;}
else if(a[time]<b[time]){return-1;}
return 0;});}
function makeFavicon(letter,color,backgroundColor){let canvas=document.createElement('canvas');canvas.width=16;canvas.height=16;let ctx=canvas.getContext('2d');ctx.fillStyle=backgroundColor;ctx.fillRect(0,0,16,16);let ctx2=canvas.getContext("2d");ctx2.fillStyle=color;ctx2.font="bold 12px Arial";ctx2.fillText(letter,4,12);let link=document.getElementById("favicon-link");link.href=canvas.toDataURL("image/x-icon");}let contactsTableElement=document.getElementById("contacts-table");let contactsEditForm=document.getElementById("contacts-edit-form");let contactsEditFormMessage=document.getElementById("contacts-edit-form-message");let contactsSortAscending=1;let contactsTable={"name":"Contacts","headers":["First Name","Middle Name","Last Name","Mobile Phone","Home Phone","Business Phone","E-mail Address","Home Address","Notes"],"inputTypes":{"First Name":"text","Middle Name":"text","Last Name":"text","Mobile Phone":"tel","Home Phone":"tel","Business Phone":"tel","E-mail Address":"email","Home Address":"textarea","Notes":"textarea"},"data":[]}
let calendarTable=document.getElementById("calendar-table");let calendarEditForm=document.getElementById("calendar-edit-form");let calendarEditFormMessage=document.getElementById("calendar-edit-form-message");let monthChooser=document.getElementById("month-chooser");let daysAbbreviations=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"];let calendarSortAscending=1;let calendarDatabase={"name":"Calendar","headers":["Subject","Start Date","Start Time","End Date","End Time","Description","UID"],"inputTypes":{"Subject":"text","Start Date":"date","Start Time":"time","End Date":"date","End Time":"time","Description":"textarea","UID":"text"},"data":[]}
let combinedDatabase={"contacts":contactsTable,"calendar":calendarDatabase}
initializeCalendarApp();function initializeCalendarApp(){monthChooser.addEventListener("input",makeCalendar);monthChooser.addEventListener("change",makeCalendar);monthChooser.value=getTodaysDate().slice(0,-3);console.log(getTodaysDate().slice(0,-3));makeCalendar();}
function processCalendarHome(){makeCalendar();showPlannerDiv("planner-calendar-start");}
function processCalendarCSVClick(){let date=document.getElementById("calendar-date").value;;let tempTable={};tempTable["data"]=[];for(let i=0;i<calendarDatabase["data"].length;i++){if((date===calendarDatabase["data"][i]["Start Date"])||(date===calendarDatabase["data"][i]["End Date"])||((date>=calendarDatabase["data"][i]["Start Date"])&&(date<=calendarDatabase["data"][i]["End Date"]))){tempTable["data"].push(calendarDatabase["data"][i]);}}
tempTable["headers"]=calendarDatabase["headers"];tempTable=JSON.parse(JSON.stringify(tempTable));tempTable["name"]="Calendar";processCSVClick(tempTable);}
function buildCalendarTableElement(date){let allRows=calendarDatabase["data"];let filteredRows=[];let numberOfColumns=calendarDatabase["headers"].length;for(let i=0;i<allRows.length;i++){if((date===allRows[i]["Start Date"])||(date===allRows[i]["End Date"])||((date>=allRows[i]["Start Date"])&&(date<=allRows[i]["End Date"]))){let tempRow=JSON.parse(JSON.stringify(allRows[i]));tempRow["intBaseIndex"]=i;filteredRows.push(tempRow);}}
destructiveDoubleSortAscending(filteredRows,"Start Date","Start Time");let tableElement="";tableElement+="<table>";tableElement+="<thead><tr>";for(let j=0;j<numberOfColumns;j++){tableElement+="<th onclick='//sortCalendarByField(this);'>"+calendarDatabase["headers"][j]+"</th>";}
tableElement+="</tr></thead>";tableElement+="<tbody>";for(let i=0;i<filteredRows.length;i++){{tableElement+="<tr id='calendar-table-row-"+i.toString()+"' onclick=\"selectCalendarEditForm("+(filteredRows[i]["intBaseIndex"]).toString()+")\">";for(let j=0;j<numberOfColumns;j++){let fieldName=calendarDatabase["headers"][j];tableElement+="<td><pre>"+filteredRows[i][fieldName]+"</pre></td>";}
tableElement+="</tr>";}}
tableElement+="</tbody>";return tableElement;}
function newCalendarEntry(table){calendarEditFormMessage.innerHTML=document.getElementById("calendar-date").value+": New Entry";calendarEditForm.innerHTML=buildCalendarEditForm(-1);showPlannerDiv("planner-calendar-form")}
function selectCalendarEditForm(calendarDatabaseRowIndex){calendarEditFormMessage.innerHTML=document.getElementById("calendar-date").value+": Entry "+calendarDatabaseRowIndex.toString();calendarEditForm.innerHTML=buildCalendarEditForm(calendarDatabaseRowIndex);showPlannerDiv("planner-calendar-form");}
function buildCalendarEditForm(index){let date=document.getElementById("calendar-date").value;let thisEntry=calendarDatabase["data"][index];let editForm="";editForm+="<form>";editForm="<input type='hidden' id='calendar-row-index' value='"+index.toString()+"'>";let numberOfColumns=calendarDatabase["headers"].length;let headers=calendarDatabase["headers"];let row=thisEntry;let inputTypes=calendarDatabase["inputTypes"];for(let j=0;j<numberOfColumns;j++){let extraString="";if(inputTypes[headers[j]]==="number"){extraString=" step='any' ";}else if(inputTypes[headers[j]]==="tel"){extraString=" placeholder='304-424-1000' pattern='[0-9]{3}-[0-9]{3}-[0-9]{4}' ";}
if((headers[j]==="Start Date")&&(index===-1)){extraString="value="+date};if((headers[j]==="End Date")&&(index===-1)){extraString="value="+date};if(headers[j]==="UID"){extraString="disabled"};if(inputTypes[headers[j]]!=="textarea"){console.log("not textarea")
if(index===-1){editForm+="<div><label for='"+headers[j]+"'>"+headers[j]+"</label></div><div><input type='"+inputTypes[headers[j]]+"' id='"+headers[j]+"' "+extraString+"></div>";}else{editForm+="<div><label for='"+headers[j]+"'>"+headers[j]+"</label></div><div><input type='"+inputTypes[headers[j]]+"' id='"+headers[j]+"' value='"+row[headers[j]].split("\"").join("&quot;").split("\'").join("&apos;")+"'"+extraString+"></div>";}}else{console.log("textarea!")
if(index===-1){editForm+="<div><label for='"+headers[j]+"'>"+headers[j]+"</label></div><div><textarea id='"+headers[j]+"' "+extraString+"></textarea></div>";}else{let textAreaContents=row[headers[j]].split("\"").join("&quot;").split("\'").join("&apos;");console.log(textAreaContents);editForm+="<div><label for='"+headers[j]+"'>"+headers[j]+"</label></div><div><textarea id='"+headers[j]+"' "+extraString+">"+textAreaContents+"</textarea></div>";}}}
editForm+="</form>";return editForm;}
function saveCalendarEntry(){let index=parseInt(document.getElementById("calendar-row-index").value);let date=document.getElementById("calendar-date").value;let headers=calendarDatabase["headers"];let row={};for(let j=0;j<headers.length;j++){row[headers[j]]=document.getElementById(headers[j]).value;}
if(row["Start Date"]===""){row["Start Date"]=date;}
if(row["Start Time"]===""){row["Start Time"]="00:00";}
if((row["UID"]==="")||(row["UID"]===undefined)){row["UID"]=makeUID(row["Start Date"],row["Start Time"]);}
if(index>=0){calendarDatabase["data"][index]=row;}else{calendarDatabase["data"].push(row);}
clearCalendarFormEntries();calendarTable.innerHTML=buildCalendarTableElement(date);showPlannerDiv("planner-calendar-table");if(confirm("Current data updated.  Save updated data to file?")){saveCombinedDatabase();}}
function exportSingleICalEvent(){let index=parseInt(document.getElementById("calendar-row-index").value);let date=document.getElementById("calendar-date").value;let headers=calendarDatabase["headers"];let row={};for(let j=0;j<headers.length;j++){row[headers[j]]=document.getElementById(headers[j]).value;}
if((row["UID"]==="")||row["UID"]===undefined){row["UID"]=makeUID(row["Start Date"],row["Start Time"]);document.getElementById("UID").innerHTML=row["UID"];}
let vEvent=makeVEvent(row,"\n");let eventsArr=[];eventsArr.push(vEvent);let vCal=makeVCalendar(eventsArr,"\n");let filename="vEvent"+row["Start Date"]+"_"+row["Start Time"].replace(/\:/g,"");copyAndSaveString(vCal,filename,".ical");if(index>=0){calendarDatabase["data"][index]=row;}else{calendarDatabase["data"].push(row);}
alert("Entry also updated in calendar.");clearCalendarFormEntries();calendarTable.innerHTML=buildCalendarTableElement(date);showPlannerDiv("planner-calendar-table");}
function makeUID(startDate,startTime){let rows=calendarDatabase["data"];let usedIDs=[];for(let i=0;i<rows.length;i++){usedIDs.push(rows[i]["UID"]);}
let UID="bitOffice."+ISOStringToICalString((htmlDateAndTimeToISOString(startDate,startTime)))+Math.random().toString();while(usedIDs.includes(UID)){UID="bitOffice."+ISOStringToICalString((htmlDateAndTimeToISOString(startDate,startTime)))+Math.random().toString();}
return UID;}
function purgeCalendar(){}
function deleteCalendarEntry(){let index=parseInt(document.getElementById("calendar-row-index").value);let date=document.getElementById("calendar-date").value;if(index>=0){if(confirm("Delete this entry?")){calendarDatabase["data"].splice(index,1);}}
clearCalendarFormEntries();calendarTable.innerHTML=buildCalendarTableElement(date);showPlannerDiv("planner-calendar-table");if(confirm("Current data updated.  Save updated data to file?")){saveCombinedDatabase();}}
function cancelCalendarEntry(){let date=document.getElementById("calendar-date").value;clearCalendarFormEntries();calendarTable.innerHTML=buildCalendarTableElement(date);showPlannerDiv("planner-calendar-table");}
function clearCalendarFormEntries(){let headers=calendarDatabase["headers"];for(let j=0;j<headers.length;j++){document.getElementById(headers[j]).value="";}
document.getElementById("calendar-row-index").value=-1;calendarEditFormMessage.innerHTML="";}
function sortCalendarByField(clickedHeaderElement){let date=document.getElementById("calendar-date").value;let field=clickedHeaderElement.innerHTML;if(calendarDatabase["dates"][date]["data"].length>1){if(confirm("Sort by "+clickedHeaderElement.innerHTML+"?")){destructiveSort(calendarDatabase["dates"][date]["data"],field,calendarSortAscending);calendarTable.innerHTML=buildCalendarTableElement(date);calendarSortAscending=-1*calendarSortAscending;};}}
function makeCalendar(){console.log("--------------------");console.log(monthChooser.value);console.log("--------------------");let d=new Date(monthChooser.value+"-01T00:00");let startDayIndex=d.getDay();let monthToUse=parseInt(monthChooser.value.split("-")[1])-1;let yearToUse=parseInt(monthChooser.value.split("-")[0]);let daysInMonth=daysInSomeMonth(monthToUse,yearToUse);let calendarString="<table>";calendarString+="<tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>";calendarString+="<tr>";for(let i=0;i<startDayIndex;i++){console.log("x",daysAbbreviations[i]);calendarString+="<td>"+"-"+"</td>";}
for(let i=0;i<daysInMonth;i++){let thisDate=i+1;let thisDayOfWeek=daysAbbreviations[(i+startDayIndex)%7];if((i+startDayIndex)%7===0){console.log("--------new line ----------");calendarString+="</tr><tr>"}
calendarString+="<td class='return-calendar-date'>"+(i+1).toString()+"</td>";}
let lastDayIndex=(daysInMonth-1+startDayIndex)%7;let blankSpacesRemaining=6-lastDayIndex;for(let i=0;i<blankSpacesRemaining;i++){calendarString+="<td>"+"-"+"</td>";}
calendarString+="</tr></table>";document.getElementById('special-calendar').innerHTML=calendarString;addEventListenersToCalendarEntries();purgeCalendar();colorCalendarEntries();return calendarString;}
function addEventListenersToCalendarEntries(){let calendarEntries=document.getElementsByClassName('return-calendar-date');for(let entry of calendarEntries){entry.addEventListener("click",(evt)=>{openDayEntry(evt)});}}
function openDayEntry(evt){let theDate=monthChooser.value+"-"+("0"+evt.target.innerHTML).slice(-2);document.getElementById("calendar-date").value=theDate;if(theDate===""){return;}
document.getElementById("calendar-table-name").innerHTML=daysAbbreviations[getDayOfWeek(theDate)]+" "+theDate+"</span>";calendarTable.innerHTML=buildCalendarTableElement(theDate);showPlannerDiv("planner-calendar-table");}
function colorCalendarEntries(){purgeCalendar();let calendarEntries=document.getElementsByClassName('return-calendar-date');for(let entry of calendarEntries){entry.style["backgroundColor"]="#E0E0E0;";let thisDate=monthChooser.value+"-"+("0"+entry.innerHTML).slice(-2);for(let i=0;i<calendarDatabase["data"].length;i++){if((thisDate===calendarDatabase["data"][i]["Start Date"])||(thisDate===calendarDatabase["data"][i]["End Date"])||((thisDate>=calendarDatabase["data"][i]["Start Date"])&&(thisDate<=calendarDatabase["data"][i]["End Date"]))){entry.style["backgroundColor"]="darkorange";}}
if(getTodaysDate()===thisDate){entry.style["border"]="1px solid grey";entry.style["font-weight"]="bold";}}}
function createOutlookCSV(){let outlookCSV=JSONToCSV(calendarDatabase,true,"\r\n");console.log(outlookCSV);copyAndSaveString(outlookCSV,"plannerToOutlookExport"+getTodaysDate(),".csv");}
function loadOutlookCSV(){if(confirm("This will add entries to the existing current calendar.\n\nIf you want to over-write all contents, please clear the calendar first, then proceed with loading the data.")){let fileContents="";let inputTypeIsFile=document.createElement('input');inputTypeIsFile.type="file";inputTypeIsFile.accept=".csv";inputTypeIsFile.addEventListener("change",function(){let inputFile=inputTypeIsFile.files[0];let fileReader=new FileReader();fileReader.onload=function(fileLoadedEvent){fileContents=fileLoadedEvent.target.result;console.log(fileContents);let outlookCSVObject=csvToJSON(fileContents);console.log(outlookCSVObject);let outlookData=outlookCSVObject["data"];let headers=calendarDatabase["headers"];let outlookHeaders=outlookCSVObject["headers"];for(let i=0;i<outlookData.length;i++){let row={};console.log(outlookData[i]);for(let j=0;j<headers.length;j++){if((headers[j]==="Start Date")||(headers[j]==="End Date")){row[headers[j]]=outlookDateToPlannerDate(outlookData[i][headers[j]]);}
else if((headers[j]==="Start Time")||(headers[j]==="End Time")){row[headers[j]]=outlookTimeToPlannerTime(outlookData[i][headers[j]]);}
else{row[headers[j]]=outlookData[i][headers[j]];}}
let addOnString="\nAdditional Information:\n_______________________";for(let j=0;j<outlookHeaders.length;j++){if(row.hasOwnProperty(outlookHeaders[j])){}
else{if((outlookData[i][outlookHeaders[j]].trim()!=="")&&(outlookData[i][outlookHeaders[j]].trim()!=="Normal")){addOnString+="\n"+outlookHeaders[j]+":"+outlookData[i][outlookHeaders[j]];}}}
if(addOnString!=="\nAdditional Information:\n_______________________"){row["Description"]+=addOnString.trim();row["Description"]=row["Description"].trim();}
calendarDatabase["data"].push(row);}
showPlannerDiv("planner-calendar-start");makeCalendar();};fileReader.readAsText(inputFile,"UTF-8");});inputTypeIsFile.click();console.log("loadOutlookCSV called");}}
function outlookDateToPlannerDate(outlookDate){let outlookData=outlookDate.trim().split("/");if(outlookData.length!==3){return outlookDate;}
let month=("0"+outlookData[0]).slice(-2);let day=("0"+outlookData[1]).slice(-2);let year=outlookData[2];console.log(outlookDate);console.log(outlookData);let plannerDate=year+"-"+month+"-"+day;console.log(plannerDate);return plannerDate;}
function outlookTimeToPlannerTime(outlookTime){let PM=false;if(outlookTime.indexOf("PM")!=-1){PM=true;}
let outlookData=outlookTime.split(":");if(!(outlookData.length>=2)){return outlookTime};let strHour=outlookData[0];let intHour=parseInt(strHour);if((PM===true)&&(intHour!==12)){intHour+=12;}
strHour=intHour.toString();strHour=("0"+strHour).slice(-2);let minutes=outlookData[1];return strHour+":"+minutes;}
function clearCalendar(){if(confirm("Are you sure?  This will clear all calendar entries")){calendarDatabase={"name":"Calendar","headers":["Subject","Start Date","Start Time","End Date","End Time","Description","UID"],"inputTypes":{"Subject":"text","Start Date":"date","Start Time":"time","End Date":"date","End Time":"time","Description":"textarea","UID":"text"},"data":[]}}
makeCalendar();}
initializeContactsApp();function initializeContactsApp(){fillInEmptyPropertyValues(contactsTable);contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);contactsEditForm.innerHTML=buildContactsEditForm(contactsTable,-1);}
function backupContactsDatabase(){return JSON.parse(JSON.stringify(contactsTable));}
function buildContactsTableElement(contactsTable){let tableElement="";let numberOfColumns=contactsTable["headers"].length;let numberOfRows=contactsTable["data"].length;tableElement+="<table>";tableElement+="<thead><tr>";for(let j=0;j<numberOfColumns;j++){tableElement+="<th onclick='sortContactsByField(this);'>"+contactsTable["headers"][j]+"</th>";}
tableElement+="</tr></thead>";tableElement+="<tbody>";for(let i=0;i<numberOfRows;i++){tableElement+="<tr id='contacts-table-row-"+i.toString()+"' onclick='selectContactsEditForm(this)'>";for(let j=0;j<numberOfColumns;j++){let fieldName=contactsTable["headers"][j];tableElement+="<td><pre>"+contactsTable["data"][i][fieldName]+"</pre></td>";}
tableElement+="</tr>";}
tableElement+="</tbody>";return tableElement;}
function newContactsEntry(){contactsEditFormMessage.innerHTML=contactsTable["name"]+": New Entry";contactsEditForm.innerHTML=buildContactsEditForm(contactsTable,-1);showPlannerDiv("planner-contacts-form");}
function selectContactsEditForm(clickedRow){let index=parseInt(clickedRow.id.split("-")[3]);contactsEditFormMessage.innerHTML=contactsTable["name"]+": Entry "+index.toString();contactsEditForm.innerHTML=buildContactsEditForm(contactsTable,index);showPlannerDiv("planner-contacts-form");}
function buildContactsEditForm(contactsTable,index){let editForm="";editForm+="<form>";editForm="<input type='hidden' id='contacts-row-index' value='"+index.toString()+"'>";let numberOfColumns=contactsTable["headers"].length;let headers=contactsTable["headers"];let row=contactsTable["data"][index];let inputTypes=contactsTable["inputTypes"];for(let j=0;j<numberOfColumns;j++){let extraString="";if(inputTypes[headers[j]]==="number"){extraString=" step='any' ";}else if(inputTypes[headers[j]]==="tel"){extraString=" placeholder='304-424-1000' pattern='[0-9]{3}-[0-9]{3}-[0-9]{4}' ";}
if(index===-1){if(inputTypes[headers[j]]==="textarea"){editForm+="<div><label for='contact-"+headers[j]+"'>"+headers[j]+"</label></div><div><textarea id='contact-"+headers[j]+"' "+extraString+"></textarea></div>";}else{editForm+="<div><label for='contact-"+headers[j]+"'>"+headers[j]+"</label></div><div><input type='"+inputTypes[headers[j]]+"' id='contact-"+headers[j]+"' "+extraString+"></div>";}}else{if(inputTypes[headers[j]]==="textarea"){let textAreaContents=row[headers[j]].split("\"").join("&quot;").split("\'").join("&apos;");editForm+="<div><label for='contact-"+headers[j]+"'>"+headers[j]+"</label></div><div><textarea id='contact-"+headers[j]+"' "+extraString+">"+textAreaContents+"</textarea></div>";}else{editForm+="<div><label for='contact-"+headers[j]+"'>"+headers[j]+"</label></div><div><input type='"+inputTypes[headers[j]]+"' id='contact-"+headers[j]+"' value='"+row[headers[j]].split("\"").join("&quot;").split("\'").join("&apos;")+"'"+extraString+"></div>";}}}
editForm+="</form>";return editForm;}
function saveContactsEntry(){let index=parseInt(document.getElementById("contacts-row-index").value);let headers=contactsTable["headers"];let row={};for(let j=0;j<headers.length;j++){row[headers[j]]=document.getElementById("contact-"+headers[j]).value;}
if(index>=0){contactsTable["data"][index]=row;}else{contactsTable["data"].push(row);}
clearContactFormEntries(contactsTable);contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);showPlannerDiv("planner-contacts-table");if(confirm("Data updated.  Save updated data to file?")){saveCombinedDatabase();}}
function exportSingleVCard(){let index=parseInt(document.getElementById("contacts-row-index").value);let headers=contactsTable["headers"];let row={};for(let j=0;j<headers.length;j++){row[headers[j]]=document.getElementById("contact-"+headers[j]).value;}
let vCard=makeSingleVCFString(row);copyAndSaveString(vCard,row["First Name"]+"-"+row["Last Name"]+"-"+"Contact"+"-"+getTodaysDate(),".vcf");if(index>=0){contactsTable["data"][index]=row;}else{contactsTable["data"].push(row);}
alert("Entry also updated in contacts.");clearContactFormEntries(contactsTable);contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);showPlannerDiv("planner-contacts-table");}
function deleteContactsEntry(){let index=parseInt(document.getElementById("contacts-row-index").value);if(index>=0){if(confirm("Delete this entry?")){contactsTable["data"].splice(index,1);}}
clearContactFormEntries(contactsTable);contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);showPlannerDiv("planner-contacts-table");if(confirm("Current data updated.  Save updated data to file?")){saveCombinedDatabase();}}
function cancelContactsEntry(){clearContactFormEntries(contactsTable);contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);showPlannerDiv("planner-contacts-table");}
function clearContactFormEntries(contactsTable){let headers=contactsTable["headers"];for(let j=0;j<headers.length;j++){document.getElementById("contact-"+headers[j]).value="";}
document.getElementById("contacts-row-index").value=-1;contactsEditFormMessage.innerHTML="";}
function sortContactsByField(clickedHeaderElement){let field=clickedHeaderElement.innerHTML;if(contactsTable["data"].length>1){if(confirm("Sort by "+clickedHeaderElement.innerHTML+"?\n\nThis cannot be undone.")){destructiveSort(contactsTable["data"],field,contactsSortAscending);contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);contactsSortAscending=-1*contactsSortAscending;}}}
function loadOutlookContactsCSV(){if(confirm("This will merge entries.\n\nIf you want to over-write all contents, please clear the contacts first, then proceed with loading the data.")){let fileContents="";let inputTypeIsFile=document.createElement('input');inputTypeIsFile.type="file";inputTypeIsFile.accept=".csv";inputTypeIsFile.addEventListener("change",function(){let inputFile=inputTypeIsFile.files[0];let fileReader=new FileReader();fileReader.onload=function(fileLoadedEvent){fileContents=fileLoadedEvent.target.result;console.log(fileContents);let outlookCSVObject=csvToJSON(fileContents);console.log(outlookCSVObject);let outlookData=outlookCSVObject["data"];let headers=contactsTable["headers"];let outlookHeaders=outlookCSVObject["headers"];for(let i=0;i<outlookData.length;i++){let row={};console.log(outlookData[i]);for(let j=0;j<headers.length;j++){row[headers[j]]=outlookData[i][headers[j]];}
let addOnString="\r\nAdditional Information:\r\n_______________________";for(let j=0;j<outlookHeaders.length;j++){console.log(outlookHeaders[j]);if(row.hasOwnProperty(outlookHeaders[j])){}
else{if((outlookData[i][outlookHeaders[j]].trim()==="")||(outlookHeaders[j].trim()==="Categories")){}else{addOnString+="\r\n"+outlookHeaders[j]+":"+outlookData[i][outlookHeaders[j]];console.log("extra: "+outlookHeaders[j]+"\n"+outlookData[i][outlookHeaders[j]]);}}}
if(addOnString==="\r\nAdditional Information:\r\n_______________________"){row["Notes"]=row["Notes"].trim();}else{row["Notes"]=row["Notes"].trim();row["Notes"]+="\r\n"+addOnString;}
contactsTable["data"].push(row);}
contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);showPlannerDiv("planner-contacts-table");};fileReader.readAsText(inputFile,"UTF-8");});inputTypeIsFile.click();console.log("loadOutlookContactsCSV called");}}
function saveOutlookContactsCSV(){let thisCSV=makeCSV(contactsTable,true);copyAndSaveString(thisCSV,contactsTable["name"]+getTodaysDate(),".csv");}
function importVCF(){if(confirm("This will merge entries.\n\nIf you want to over-write all contents, please clear the contacts first, then proceed with loading the data.")){let fileContents="";let inputTypeIsFile=document.createElement('input');inputTypeIsFile.type="file";inputTypeIsFile.accept=".vcf";inputTypeIsFile.addEventListener("change",function(){let inputFile=inputTypeIsFile.files[0];let fileReader=new FileReader();fileReader.onload=function(fileLoadedEvent){fileContents=fileLoadedEvent.target.result;readInAllVcards(fileContents);contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);showPlannerDiv("planner-contacts-table");};fileReader.readAsText(inputFile,"UTF-8");});inputTypeIsFile.click();}}
function importICSCalendar(){if(confirm("This will merge entries.  Continue?")){let fileContents="";let inputTypeIsFile=document.createElement('input');inputTypeIsFile.type="file";inputTypeIsFile.accept=".ics";inputTypeIsFile.addEventListener("change",function(){let inputFile=inputTypeIsFile.files[0];let fileReader=new FileReader();fileReader.onload=function(fileLoadedEvent){fileContents=fileLoadedEvent.target.result;let events=getVEVENTSFromICS(fileContents);for(let i=0;i<events.length;i++){let row=parseVEVENTToObject(events[i]);if((row["UID"]==="")||(row["UID"])===undefined){row["UID"]=makeUID(row["Start Date"],row["Start Time"]);}
calendarDatabase["data"].push(row);}
showPlannerDiv('planner-calendar-start');makeCalendar();};fileReader.readAsText(inputFile,"UTF-8");});inputTypeIsFile.click();}}
function getVEVENTSFromICS(contents){contents.replace(/(\r\n|\r|\n)/g,"\\\n");contents=contents.trim();lines=contents.split("\n");let events=[];let str="";let inside=false;for(let i=0;i<lines.length;i++){if(inside===true){if(lines[i].slice(0,10)==="END:VEVENT"){inside=false;events.push(str);str="";}
else{str+=lines[i]+="\n";}}
if((lines[i].slice(0,12))==="BEGIN:VEVENT"){inside=true;}}
return events;}
function parseVEVENTToObject(vEvent){let row={}
vEvent=vEvent.replace(/(\r\n|\r|\n)/g,"\n");vEvent=vEvent.trim();let lines=vEvent.split("\n");row["Subject"]="";row["Description"]="";row["UID"]="";row["Start Date"]="";row["Start Time"]="";row["End Date"]="";row["End Time"]="";let extraStuff="\n-------Extra Stuff-------\n";for(let i=0;i<lines.length;i++){let line=lines[i];if(line.slice(0,7)==="SUMMARY"){row["Subject"]=line.split(":")[1];}
else if(line.slice(0,11)==="DESCRIPTION"){row["Description"]=line.split(":")[1];}
else if(line.slice(0,3)==="UID"){row["UID"]=line.split(":")[1];}
else if(line.slice(0,7)==="DTSTART"){let iCalStartDate=line.split(":")[1];let ISOString=iCalDateToISOString(iCalStartDate);let startDateObject=new Date(ISOString);let year=startDateObject.getFullYear().toString();let month=("0"+((startDateObject.getMonth()+1).toString())).slice(-2);let date=("0"+(startDateObject.getDate().toString())).slice(-2);let hours=("0"+((startDateObject.getHours()+1).toString())).slice(-2);let minutes=("0"+(startDateObject.getMinutes().toString())).slice(-2);let seconds=("0"+(startDateObject.getSeconds().toString())).slice(-2);row["Start Date"]=year+"-"+month+"-"+date;row["Start Time"]=hours+":"+minutes+":"+seconds;}
else if(line.slice(0,5)==="DTEND"){let iCalEndDate=line.split(":")[1];let ISOString=iCalDateToISOString(iCalEndDate);let endDateObject=new Date(ISOString);let year=endDateObject.getFullYear().toString();let month=("0"+((endDateObject.getMonth()+1).toString())).slice(-2);let date=("0"+(endDateObject.getDate().toString())).slice(-2);let hours=("0"+((endDateObject.getHours()+1).toString())).slice(-2);let minutes=("0"+(endDateObject.getMinutes().toString())).slice(-2);let seconds=("0"+(endDateObject.getSeconds().toString())).slice(-2);row["End Date"]=year+"-"+month+"-"+date;row["End Time"]=hours+":"+minutes+":"+seconds;}
else{extraStuff+=line+"\n";}}
row["Description"]+=extraStuff;return row;}
function iCalDateToISOString(icalDate){let year=icalDate.slice(0,4);let month=parseInt(icalDate.slice(4,6));let day=icalDate.slice(6,8);let dateObject;if(icalDate.indexOf("T")!==-1){hour=icalDate.slice(9,11);min=icalDate.slice(11,13);sec=icalDate.slice(13,15);dateObject=new Date(year,month,day,hour,min,sec);}
else{dateObject=new Date(year,month,day);}
return dateObject.toISOString();}
function readInAllVcards(contents){let startIndex=contents.indexOf("BEGIN:VCARD");let endIndex=contents.indexOf("END:VCARD");while(startIndex!==-1){let vCard=contents.substring(startIndex,endIndex+9);let contactObject=parseContactFromVCard(vCard);contactsTable["data"].push(contactObject);startIndex=contents.indexOf("BEGIN:VCARD",endIndex);endIndex=contents.indexOf("END:VCARD",startIndex+1);};}
function parseContactFromVCard(vCard){vCard=vCard.trim();vCard=vCard.replace(/;PREF/g,"");vCard=vCard.replace(/;VOICE/g,";HOME");vCard=vCard.replace(/\r\n|\n|\r/gm,"\n");let lines=vCard.split("\n");let prefixes=["ADR;HOME:","EMAIL:","FN:","NOTE:","TEL;CELL:","TEL;HOME:","TEL;WORK:","N:"];let contactObjectKeys=["Home Address","E-mail Address","First Name","Notes","Mobile Phone","Home Phone","Business Phone","Last Name","Middle Name"];let contactObject={};for(let i=0;i<prefixes.length;i++){for(j=0;j<lines.length;j++){if(lines[j].substring(0,prefixes[i].length)===prefixes[i]){if(prefixes[i]==="N:"){let lastName=lines[j].substring(prefixes[i].length).split(";")[0];contactObject["Last Name"]=lastName;let middleName=lines[j].substring(prefixes[i].length).split(";")[2];contactObject["Middle Name"]=middleName;let firstName=lines[j].substring(prefixes[i].length).split(";")[1];contactObject["First Name"]=firstName;}
else{console.log("found match for ",prefixes[i],);{contactObject[contactObjectKeys[i]]=lines[j].substring(prefixes[i].length);}}}}}
let headers=contactsTable["headers"];for(let i=0;i<headers.length;i++){if(contactObject.hasOwnProperty(headers[i])){}
else{contactObject[headers[i]]="";}}
let extras=["ADR","AGENT","ANNIVERSARY","BDAY","CALADRURI","CALURI","CATEGORIES","CLASS","CLIENTPIDMAP","FBURL","GENDER","GEO","IMPP","KEY","KIND","LABEL","LANG","MAILER","MEMBER","NAME","NICKNAME","ORG","PRODID","PROFILE","RELATED","REV","ROLE","SORT-STRING","SOURCE","TEL","TITLE","TZ","UID","URL","XML"];for(let i=0;i<lines.length;i++){if(prefixes.includes(lines[i].split(":")[0]+":")){}
else{for(j=0;j<extras.length;j++){if(lines[i].substring(0,extras[j].length)===extras[j]){console.log("found extra ",extras[j]);contactObject["Notes"]+="\n"+extras[j]+lines[i].substring(extras[j].length);}}}}
return contactObject;}
function exportVCF(){let str="";let rows=contactsTable["data"];for(let i=0;i<rows.length;i++){str+=makeSingleVCFString(rows[i]);}
console.log(str);copyAndSaveString(str,"vcf"+contactsTable["name"]+getTodaysDate(),".vcf");}
function makeSingleVCFString(row){let str="";console.log(row);str+="BEGIN:VCARD\n";str+="VERSION:2.1\n";let familyName="";let givenName="";let middleName="";if(row["Last Name"]!==undefined){familyName=row["Last Name"];familyName=familyName.replace(/\;/g," ");}
if(row["First Name"]!==undefined){givenName=row["First Name"];givenName=givenName.replace(/\;/g," ");}
if(row["Middle Name"]!==undefined){middleName=row["Middle Name"];middleName=middleName.replace(/\;/g," ");}
str+="N:"+familyName+";"+givenName+";"+middleName+";;\n"
str+="FN:"+givenName+" "+middleName+" "+familyName+"\n";if((row["Mobile Phone"]!==undefined)&&(row["Mobile Phone"]!=="")){str+="TEL;CELL:"+row["Mobile Phone"]+"\n";}
if((row["Home Phone"]!==undefined)&&(row["Home Phone"]!=="")){str+="TEL;HOME:"+row["Home Phone"]+"\n";}
if((row["Business Phone"]!==undefined)&&(row["Business Phone"]!=="")){str+="TEL;WORK:"+row["Business Phone"]+"\n";}
if((row["E-mail Address"]!==undefined)&&(row["E-mail Address"]!=="")){str+="EMAIL:"+row["E-mail Address"]+"\n";}
if((row["Home Address"]!==undefined)&&(row["Home Address"]!=="")){str+="ADR;HOME:"+row["Home Address"]+"\n";}
if((row["Notes"]!==undefined)&&(row["Notes"]!=="")){str+="NOTE:"+row["Notes"]+"\n";}
str+="END:VCARD\n";return str;}
function showPlannerDiv(id){let divs=document.getElementsByClassName('planner-div');for(let div of divs){div.style.display="none";}
document.getElementById(id).style.display="unset";document.getElementById("planner-ribbon").style.display="none";document.getElementById("back-home-nav").style.display="flex";}
function backHomePlanner(){showPlannerDiv("planner-home");document.getElementById("planner-ribbon").style.display="flex";document.getElementById("back-home-nav").style.display="none";}
function loadCombinedDatabase(){let fileContents="";let inputTypeIsFile=document.createElement('input');inputTypeIsFile.type="file";inputTypeIsFile.accept=".bof";inputTypeIsFile.addEventListener("change",function(){let inputFile=inputTypeIsFile.files[0];let fileReader=new FileReader();fileReader.onload=function(fileLoadedEvent){fileContents=fileLoadedEvent.target.result;combinedDatabase=JSON.parse(fileContents);contactsTable=combinedDatabase["contacts"];calendarDatabase=combinedDatabase["calendar"];if(calendarDatabase["headers"].includes("UID")){}
else{calendarDatabase["headers"].push("UID");calendarDatabase["inputTypes"]["UID"]="text";}
let dataRows=calendarDatabase["data"];for(let i=0;i<dataRows.length;i++){if((dataRows[i]["UID"]==="")||(dataRows[i]["UID"]===undefined)){dataRows[i]["UID"]=makeUID(dataRows["Start Date"],dataRows["Start Time"]);}}
clearContactFormEntries(contactsTable);contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);makeCalendar();backHomePlanner();};fileReader.readAsText(inputFile,"UTF-8");});inputTypeIsFile.click();}
function saveCombinedDatabase(){purgeCalendar();let str=JSON.stringify(combinedDatabase);let baseFilename="bitOfficePlanner"+getTodaysDate();saveStringToTextFile(str,baseFilename,".json");}
function makeVEvent(row,lineTerminator="\n"){let lt=lineTerminator;str="";let subject=row["Subject"];let startDate=row["Start Date"];let UID=row["UID"];if((startDate==="")||(startDate===undefined)){return;}
let startTime=row["Start Time"];if((startTime==="")||(startTime===undefined)){startTime="00:00";}
let endDate=row["End Date"];if((endDate==="")||(endDate===undefined)){endDate=startDate;}
let endTime=row["End Time"];if((endTime==="")||(endTime===undefined)){endTime=startTime;}
if((UID==="")||(UID===undefined)){UID=makeUID(startDate,startTime);}
let description=row["Description"];let nowDate=new Date();let nowString=nowDate.toISOString();nowString=ISOStringToICalString(nowString);str+="BEGIN:VEVENT"+lt;str+="SUMMARY:"+subject.trim()+lt;str+="DTSTART:"+ISOStringToICalString(htmlDateAndTimeToISOString(startDate,startTime)).trim()+lt;str+="DTEND:"+ISOStringToICalString(htmlDateAndTimeToISOString(endDate,endTime)).trim()+lt;str+="DESCRIPTION:"+description.trim()+lt;str+="DTSTAMP:"+nowString.trim()+lt;str+="UID:"+UID.trim()+lt;str+="END:VEVENT";return str;}
function htmlDateAndTimeToISOString(date="2023-01-31",time){if((time==="")||(time===undefined)){time="00:00";}
let year=parseInt(date.slice(0,4));let month=parseInt(date.slice(5,7))-1;let day=parseInt(date.slice(8));let hour=parseInt(time.slice(0,2));let min=parseInt(time.slice(3));let d=new Date(year,month,day,hour,min);return(d.toISOString());}
function ISOStringToICalString(ISOString){return(ISOString.replace(/\.\d\d\dZ/,"Z").replace(/\-|\:|\./g,""));}
function makeVEventsArr(dataRows){let arr=[];for(let i=0;i<dataRows.length;i++){arr.push(makeVEvent(dataRows[i]).trim());}
return arr;}
function makeVCalendar(vEventsArr,lineTerminator="\n"){let str="";let lt=lineTerminator;str+="BEGIN:VCALENDAR"+lt;str+="VERSION:2.0"+lt;str+="PRODID:bitOffice"+lt;str+="CALSCALE:GREGORIAN"+lt;for(let i=0;i<vEventsArr.length;i++){str+=vEventsArr[i].trim()+lt;}
str+="END:VCALENDAR";return str;}
function exportICSCalendar(){let eventsArr=makeVEventsArr(calendarDatabase["data"]);let cal=makeVCalendar(eventsArr);copyAndSaveString(cal,"ICSCalendar"+getTodaysDate(),".ics");}let nestedMenues=document.getElementsByClassName("nested-menu");for(let nestedmenu of nestedMenues){nestedmenu.addEventListener("click",(evt)=>{toggleNest(evt.target)});}
function toggleNest(menu){let siblings=menu.parentElement.children;for(let sibling of siblings){if(sibling===menu){}else{if(sibling.style.display==="none"){sibling.style.display="inherit";}else{sibling.style.display="none";}}}}
function toggleAll(){for(let nestedmenu of nestedMenues){toggleNest(nestedmenu)}}
function openSelectedInitialNests(){for(let nestedmenu of nestedMenues){if(nestedmenu.classList.contains("initial-open")){toggleNest(nestedmenu);}}}
toggleAll();openSelectedInitialNests();</script><script>let selfString="";function createSelf(){let html=document.getElementsByTagName("html")[0].innerHTML;selfString+="<!DOCTYPE html><html lang='en'>"+html+"</html>";}
window.onload=createSelf();makeFavicon("p", "white", "mediumblue");
window.onbeforeunload = askConfirm;
document.getElementById("top-nav").style.display="none";
showPlannerDiv('planner-startup');
showMain('main-planner');

</script></body>
</html>