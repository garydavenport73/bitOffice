<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><style>html{box-sizing:border-box;font-size:16px}*,*:before,*:after{box-sizing:inherit}body,h1,h2,h3,h4,h5,h6,p,ol,ul{margin:0;padding:0;font-weight:400}ol,ul{list-style:none}img{max-width:100%;height:auto}html{background-color:#f0f8ff}h1:not(#document-result h1){color:#e6e6fa;background-color:#0000cd;font-family:Arial,Helvetica,sans-serif;font-size:32px;font-weight:700;padding:2px}#top-nav{color:#fff;background-color:#0000cd;padding-bottom:2px}#top-nav button{font-size:1.4rem;padding:5px;margin:1px;min-height:25px;background-color:#e0e0e0;border:#e0e0e0;border-radius:5px}h2:not(#document-result h2){margin:16px;font-weight:700;text-align:center;padding:2px;border-radius:5px;font-family:Arial,Helvetica,sans-serif;border:1px solid grey}#main-planner h2{color:#000;background-color:orange}#main-notes h2{background-color:orange;color:#000}#main-write h2{background-color:#5f9ea0}#main-tables h2{background-color:#228b22;color:#faebd7}#main-write h2{background-color:#5f9ea0;color:#faebd7}#main-calculator h2{background-color:dimgrey;color:snow}#document-result h1,#document-result h2,#document-result h3,#document-result h4{background-color:unset;color:unset}#document-result *{background-color:unset;width:unset;text-align:unset;border-radius:unset;margin-left:unset;margin-right:unset;width:unset;padding-bottom:unset;align-items:unset;border-radius:unset;margin:unset;padding:unset}#document-parent{margin:0;padding:0;width:100%;background-color:#fafad2}#document-result{overflow-wrap:break-word;min-height:100px;width:auto;background-color:#fafad2;white-space:pre-wrap}main{background-color:#e0e0e0}body{width:320px;background-color:#87cefa;background-color:#e0e0e0;margin:auto;padding:5px;box-sizing:border-box}h1:not(#document-result h1),h2:not(#document-result h2),h3:not(#document-result h3),nav{display:flex;flex-direction:row;justify-content:center}#edit-bar,#document-settings{display:flex;justify-content:left;flex-wrap:wrap;background-color:#5f9ea0;border:1px solid #000;margin:0;padding:0}#edit-bar button,#document-settings button{border-radius:5px;background-color:#e0e0e0;border:1px solid grey;padding:1px 4px;margin:0}#text-editor{width:100%;max-width:100%;overflow-wrap:break-word;min-height:100px;margin-top:0;margin-bottom:0}footer{position:fixed;bottom:0;left:50%;transform:translate(-50%,0%)}button{padding:5px}#main-planner,#main-notes,#main-write,#main-tables,#main-calculator{display:flex;flex-direction:column}#planner-ribbon>button{font-size:18px}main{min-height:320px}#planner-contacts-form *,#planner-calendar-form *{width:100%;display:auto;box-sizing:border-box}#planner-planner-help ul li,#tables-help ul li{list-style-position:inside;list-style-type:disc;margin:0 15px}#planner-planner-help ol li,#tables-help ol li{list-style-position:inside;list-style-type:decimal;margin:0 15px}#planner-planner-help p,#tables-help p{margin:15px}#planner-help,#tables-help pre{font-size:12px}#Description{height:100px}.table-container table,.table-container table td,.table-container table th{border:1px solid #000;border-collapse:collapse}.table-container pre{white-space:pre-wrap;font-size:12px;word-break:break-all}.table-container table{box-sizing:border-box;margin:auto;width:100%}#contacts-table th,#contacts-table td,#calendar-table th,#calendar-table td{display:none}#calendar-table th:nth-of-type(1),#calendar-table th:nth-of-type(2),#calendar-table th:nth-of-type(3),#calendar-table td:nth-of-type(1),#calendar-table td:nth-of-type(2),#calendar-table td:nth-of-type(3){display:table-cell}#contacts-table td:nth-of-type(1),#contacts-table th:nth-of-type(1),#contacts-table th:nth-of-type(4),#contacts-table td:nth-of-type(4){display:table-cell}#contacts-table th:nth-of-type(3),#contacts-table td:nth-of-type(3){display:table-cell}#calendar-container{margin:10px;display:flex;flex-direction:column;align-items:center}#special-calendar{background-color:snow;font-family:Arial,Verdana,Helvetica,Tahoma,sans-serif;font-size:16px;padding:0;margin:0;background-color:#fff}#special-calendar table td{height:32px;text-align:center;width:32px}#special-calendar{border:1px solid grey;width:240px}#month-chooser{background-color:#f5f5f5;min-height:30px;border-radius:5px;width:240px;text-align:center;font-family:Arial,Helvetica,sans-serif;font-size:16px}#calendar-date{display:none}main h3{background-color:#e0e0e0}.nested-menu:hover{color:snow;background-color:grey}#tables-table th:hover:not(:first-of-type),#tables-table td:first-of-type:hover{background-color:#fff}#add-row:hover,#add-column:hover{background-color:#fff}#add-column{min-width:1rem}.table-container{display:block;overflow-x:auto;margin-left:auto;margin-right:auto;width:100%;text-align:center}#tables-table input{width:100%;border:none}#tables-table input:hover{background-color:lightgrey}#tables-table td{padding:0}#tables-table th:not(:last-of-type){min-width:3rem}#tables-table th:first-of-type{min-width:1rem}#tables-table{border:none}#tables-table th{border:none}.tables-table-row-number{border:none!important}#tables-table{background-color:lightgrey}#tables-table-table{}#tables-tables-header-form>div,#tables-tables-row-form>div{display:flex;flex-direction:column;text-align:center;width:50%;margin:auto}#tables-tables-header-form *,#tables-tables-row-form *{text-align:center}#tables-tables-header-form>div>div,#tables-tables-row-form>div>div{margin:5px 0}#tables-tables-header-form>div>div>*,#tables-tables-row-form>div>div>*{width:100%}#calculator-table{width:100%;min-width:0%}#calculator-table td button{font-size:2rem;width:100%;height:4rem}.special-calculator-button{background-color:#fc3;border:1px solid grey}#last-calculator-expression{overflow-wrap:anywhere;min-height:18px;color:grey}#calculator-input{width:100%;height:40px;font-size:1.4rem;text-align:right}#calc-clr button{width:50%;font-size:1.4rem;padding:5px}main nav button{background-color:#e0e0e0;border:1px solid grey;border-radius:3px}#startup-load-button,#startup-save-button{font-size:1.4rem}#planner-load,#planner-save{margin:40px}#planner-contacts-table,#planner-calendar-start{margin-top:1rem}#planner-contacts-table nav,#planner-calendar-start nav{min-height:36px}#new-contacts-button{font-size:1.4rem;padding:4px 10px}#contacts-table{margin-top:10px}</style><link id="favicon-link" rel="icon" type="image/x-icon" href="">
<title>bitOffice</title>
</head>

<body>
    <h1 onclick="alert(license);">bitOffice</h1>
    <nav id="top-nav">
        <button onclick="showMain('main-planner');">&#9742;&#128197;</button>
        <button onclick="showMain('main-notes');">&#128196;</button>
        <button onclick="showMain('main-write');">&#128221;</button>
        <button onclick="showMain('main-tables');">&#9638;</button>
        <button onclick="showMain('main-calculator');">&#128290;</button>
        <!-- <button onclick="saveSelf()">&darr;</button> -->
    </nav><main id="main-planner">
    <h2 id="planner-h2">Planner</h2>
    <!-- <nav id="back-home-nav">
            <button onclick="backHomePlanner();">&larr;Back to Main</button>
        </nav> -->

        
    <nav id="planner-ribbon">
        <!-- <button onclick="showPlannerDiv('planner-startup');">&#128194;</button>
            <button onclick="showPlannerDiv('planner-contacts-table');">&#9742;</button>
            <button onclick="showPlannerDiv('planner-calendar-start');makeCalendar();">&#128197;</button>
            <button onclick="showPlannerDiv('planner-planner-help');">?</button> -->
        <!-- <button onclick="showPlannerDiv('planner-startup');">&#128194;</button> -->
        <button onclick="showPlannerDiv('planner-load');">&#128194;</button>
        <button onclick="showPlannerDiv('planner-save');">&#128193;</button>
        <button onclick="showPlannerDiv('planner-contacts-table');">&#9742;</button>
        <button onclick="showPlannerDiv('planner-calendar-start');makeCalendar();">&#128197;</button>
        <button onclick="showPlannerDiv('planner-planner-help');">?</button>
    </nav>
    <!-- <div class="planner-div" id="planner-home">
        <h3>Planner-Home</h3>
    </div> -->
    <!-- <div class="planner-div" id="planner-startup">
        <h3>Planner-Load/Save</h3>
        <nav>
            <button id="startup-load-button" onclick="loadCombinedDatabase()">&#128194; Load</button>
            <button id="saveButton" onclick="saveCombinedDatabase()">&#128193; Save</button>
        </nav>
    </div> -->
    <div class="planner-div" id="planner-load">
        <!-- <h3>Planner-Load</h3> -->
        <nav>
            <button id="startup-load-button" onclick="loadCombinedDatabase()">Load<br>&#128194;</button>
            <!-- <button id="saveButton" onclick="saveCombinedDatabase()">&#128193; Save</button> -->
        </nav>
    </div>
    <div class="planner-div" id="planner-save">
        <!-- <h3>Planner-Save</h3> -->
        <nav>
            <!-- <button id="startup-load-button" onclick="loadCombinedDatabase()">&#128194; Load</button> -->
            <button id="startup-save-button" onclick="saveCombinedDatabase()">Save<br>&#128193;</button>
        </nav>
    </div>
    <div class="planner-div" id="planner-planner-help">
        <h3>Planner-Help</h3>

        <p>You can:
        <ul>
            <li>Load/Save your data to its native format. This will save both the Contacts and Calendar in one file.
            </li>
            <li>You can export all contacts to a file containing vCards</li>
            <li>You can a single vCard</li>
            <li>You can export your entire calendar in vCalendar format (.ics format)</li>
            <li>You can export a single event in vCalendar format (.ics format)</li>
        </ul>
        </p>
        <p>
            Most programs like Google Calendar or Microsoft Outlook can import or export these files.
        </p>
        <hr>
        <p>
            <i>Notes on importing:</i>
        </p>

        <p>
            The program only supports a limited number of fields. When importing from a
            different program, any fields not supported will be read into the "Notes" area on Contacts and the
            "Description" area on Calendar entries. Also, photos, audio, and video are not supported.
        </p>
    </div>
    <div class="planner-div" id="planner-contacts-table">
        <!-- <h3>Planner-Contacts</h3> -->
        <nav>
            <!--<button onclick="processCSVClick(contactsTable);">CSV</button>-->


            <button id="new-contacts-button" onclick='newContactsEntry();'>+</button>
            <nav>
                <!-- <button onclick="loadOutlookContactsCSV();">&#128194; Import CSV</button>
                    <button onclick="saveOutlookContactsCSV();">&#128193; Export CSV</button> -->
                <button onclick="importVCF();">&#128193; Import vCards</button>
                <button onclick="exportVCF();">&#128193; Export vCards</button>
                <button onclick="removeDuplicateContacts();">&#128589;&#128589;Remove Duplicate Contacts</button>
                <button class="nested-menu">&lrarr;</button>
            </nav>
        </nav>

        <div id="contacts-table" class="table-container"></div>
    </div>
    <div class="planner-div" id="planner-contacts-form">
        <!-- <h3>Planner-Contacts Form</h3> -->
        <div id="contacts-edit-form-message"></div>
        <div id="contacts-edit-form"></div>
        <nav>
            <button onclick='saveContactsEntry();'>Save</button>
            <button onclick='deleteContactsEntry();'>Delete</button>
            <button onclick='cancelContactsEntry();'>Cancel</button>
            <button onclick='exportSingleVCard()'>Export vCard</button>
        </nav>
    </div>
    <div class="planner-div" id="planner-calendar-start">
        <!-- <h3>Planner-Calendar</h3> -->
        <nav>
            <!-- <button onclick="loadOutlookCSV();">&#128194; Import CSV</button>
                <button onclick="createOutlookCSV();">&#128193; Export CSV</button> -->
            <button onclick="importICSCalendar()">&#128194; Import vCalendar</button>
            <button onclick="exportICSCalendar()">&#128193; Export vCalendar</button>
            <button onclick="clearCalendar();">Clear Calendar</button>
            <button class="nested-menu">&lrarr;</button>
        </nav>

        <div id="calendar-container">
            <div><input type='date' id="calendar-date"></div>
            <input id="month-chooser" type="month">
            <div id="special-calendar"></div>
        </div>
    </div>
    <div class="planner-div" id="planner-calendar-table">
        <h3 id="calendar-table-name"></h3>
        <nav>
            <button onclick='newCalendarEntry();'>+ New Entry</button>
            <button onclick="processCalendarHome();">Back to Main Calendar</button>
            <!-- <button onclick="processCalendarCSVClick();">CSV</button> -->
        </nav>
        <div id="calendar-table" class="table-container"></div>
    </div>
    <div class="planner-div" id="planner-calendar-form">
        <h3 id="calendar-edit-form-message"></h3>
        <div id="calendar-edit-form"></div>
        <nav>
            <button onclick='saveCalendarEntry();'>Save</button>
            <button onclick='deleteCalendarEntry();'>Delete</button>
            <button onclick='cancelCalendarEntry();'>Cancel</button>
            <button onclick="exportSingleICalEvent()">Export Event</button>
        </nav>
    </div>
</main><footer onclick="alert(license);">bitOffice &copy; 2022</footer><script>let license='MIT License\n\nCopyright (c) 2022 Gary Davenport\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.';function _replaceReallCommmasInCSV(c,d){let a="",b=-1;for(let f=0;f<c.length;f++){let e=c.charAt(f);e==='"'?(b=b*-1,a+=e):e===","?b===-1?a+=d:a+=e:a+=e}return a}function _replaceRealNewlinesInCSV(c,d){let a="",b=-1;for(let f=0;f<c.length;f++){let e=c.charAt(f);e==='"'?(b=b*-1,a+=e):e==="\n"?b===-1?a+=d:a+=e:a+=e}return a}function _replaceRealCommasAndRealNewlinesInCSV(c,d,e){let a="",b=-1;for(let g=0;g<c.length;g++){let f=c.charAt(g);f==='"'?(b=b*-1,a+=f):f===","?b===-1?a+=d:a+=f:f==="\n"?b===-1?a+=e:a+=f:a+=f}return a}function tokenMaker(c){let a="",b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(let d=0;d<c;d++)a+=b[Math.floor(Math.random()*b.length)];return a}function escapeRegExp(a){return a.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')}function myReplaceAll(a,b,c){return a.replace(new RegExp(escapeRegExp(b),'g'),()=>c)}function getTokenNotInString(b,c=16){let a=tokenMaker(16);while(b.indexOf(a)!==-1)a=tokenMaker(16);return a}function csvToArrays(a){a=a.trim();let b=getTokenNotInString(a);a=a.split("\r").join(b),a=a.split(b+"\n").join("\n");let c=[];a=a.trim();let d=getTokenNotInString(a);a=_replaceReallCommmasInCSV(a,d);let e=getTokenNotInString(a);a=_replaceRealNewlinesInCSV(a,e);let f=a.split(e);for(let b=0;b<f.length;b++){let a=f[b].split(d);for(let b=0;b<a.length;b++)a[b][a[b].length-1]==='"'&&(a[b]=a[b].slice(0,a[b].length-1)),a[b][0]==='"'&&(a[b]=a[b].slice(1,a[b].length)),a[b]=a[b].split('""').join('"');c.push(a)}return c}function arraysToCSV(b,c="\n"){let a="";for(let d=0;d<b.length;d++){for(let c=0;c<b[d].length;c++)a+='"',a+=b[d][c].split('"').join('""'),a+='",';a=a.slice(0,-1)+c}return a=a.slice(0,-c.length),a}function arraysToJSON(b,d=!0){let a=[],e=[],c={};if(d===!0)for(let d=0;d<b[0].length;d++){let c=b[0][d],e=0;while(a.includes(c))console.log("WARNING - Duplicate header found: "+c),e+=1,c=c+e.toString(),console.log("Attempting rename to: "+c);a.push(c)}else for(let c=0;c<b[0].length;c++)a.push("header"+c.toString());d===!0?startRow=1:startRow=0;for(let c=startRow;c<b.length;c++){let d={};for(let e=0;e<a.length;e++)d[a[e]]=b[c][e];e.push(d)}return c.headers=a,c.data=e,c}function JSONToArrays(d,e=!0){let a=d.headers,b=d.data,c=[];if(e===!0){let b=[];for(let c=0;c<a.length;c++)b.push(a[c].toString());c.push(b)}for(i=0;i<b.length;i++){let d=[];for(let c=0;c<a.length;c++)b[i][a[c]]===void 0?d.push(""):d.push(b[i][a[c]].toString());c.push(d)}return c}function unorderedJSONToArrays(c,d=!0){let a={};a.data=c;let b=[];for(rowObject of c)for(const a in rowObject)b.includes(a)||b.push(a.toString());return a.headers=b,JSONToArrays(a,d)}function csvToJSON(b,c=!0){let a=csvToArrays(b);console.log(a);let d=arraysToJSON(a,c);return d}function JSONToCSV(a,b=!0,c="\n"){let d=JSONToArrays(a,b),e=arraysToCSV(d,c);return e}function unorderedJSONToCSV(a,b=!0){let c=unorderedJSONToArrays(a,b),d=arraysToCSV(c);return d};function saveStringToTextFile(b,h="myfile",c=".txt",d="text/plain"){let e=h+c,f=new Blob([b],{type:d}),g=window.URL.createObjectURL(f),a=document.createElement("a");a.style.display="none",a.download=e,a.href=g,document.body.appendChild(a),a.click(),a.parentElement.removeChild(a)}function copyAndSaveString(a,b="myfile",c=".txt",d="text/plain"){copyToClipBoard(a,!1),confirm("Copied to clipboard, save to file also?")&&saveStringToTextFile(a,b,c,d)}function saveWebsiteAsTextFile(b){let a=new XMLHttpRequest;a.timeout=2e3,a.ontimeout=function(a){alert("The request timed out.")},a.open('GET',b,!0),a.onreadystatechange=function(){a.readyState==4&&a.status==200&&(alert(a.responseText),console.log(a.responseText))},a.send()}function saveSelf(){let a=document.getElementsByTagName("title")[0].innerText;confirm("Duplicate and download "+a+" ?")&&saveStringToTextFile(selfString,a+"Clone",".html")}function getTodaysDate(){let a=new Date,b=("0"+a.getDate()).slice(-2),c=("0"+(a.getMonth()+1)).slice(-2),d=a.getFullYear()+"-"+c+"-"+b;return d}function getFirstDayOfThisMonthDate(){let a=new Date,b="01",c=("0"+(a.getMonth()+1)).slice(-2);return a.getFullYear()+"-"+c+"-"+b}function getLastDayOfThisMonthDate(){let b=new Date,a=daysInThisMonth().toString();a="0"+a,a=a.slice(-2);let c=("0"+(b.getMonth()+1)).slice(-2);return b.getFullYear()+"-"+c+"-"+a}function daysInSomeMonth(a,b){return new Date(b,a+1,0).getDate()}function daysInThisMonth(){return thisDate=new Date,thisMonth=thisDate.getMonth(),thisYear=thisDate.getYear(),daysInSomeMonth(thisMonth,thisYear)}function getDayOfWeek(a){let b=new Date(a+"T00:00");return b.getDay()}function serializeElementToPage(d,e=""){let f="<!DOCTYPE html><html lang='en'><head><meta charset='UTF-8'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1.0'><title></title><style>",a=document.getElementsByTagName('style'),b="";for(let c=0;c<a.length;c++)b=a[c].innerHTML;let g="</style></head><body>",h="</body></html>",i=new XMLSerializer,j=document.getElementById(d),k=i.serializeToString(j),c=f+b+e+g+k+h;return console.log(c),c}function simulateUndo(){document.execCommand('undo',!1,null)}function simulateRedo(){document.execCommand('redo',!1,null)}function askConfirm(){return"Did you remember to save your data?"}function showMain(a){let b=document.getElementsByTagName('main');for(let a of b)a.style.display="none";document.getElementById(a).style.display="flex"}function copyToClipBoard(b,c=!0){let a=document.createElement('textarea');return a.value=b,a.setAttribute('readonly',''),a.style={position:'absolute',left:'-9999px'},document.body.appendChild(a),a.select(),document.execCommand('copy'),document.body.removeChild(a),c&&alert('Copied to Clipboard.'),b}function fillInEmptyPropertyValues(c){let a=c.data,b=c.headers;for(let c=0;c<a.length;c++)for(let d=0;d<b.length;d++)a[c][b[d]]===void 0&&(a[c][b[d]]="")}function makeCSV(a,b=!0){return JSONToCSV(a,b,"\n")}function tokenMaker(c){let a="",b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",d=0;for(let d=0;d<c;d++)a+=b[Math.floor(Math.random()*b.length)];return console.log(a),a}function processCSVClick(b){let a="";a=makeCSV(b,!0),copyToClipBoard(a),confirm("Table copied to CSV.\n\nSave to file also?")&&copyAndSaveString(a,b.name+getTodaysDate(),".csv")}function destructiveSort(c,a,b=1){b!=-1&&(b=1),c.sort((c,d)=>c[a]<d[a]?-1*b:c[a]>d[a]?1*b:0)}function destructiveDoubleSortAscending(c,a,b){c.sort((c,d)=>c[a]>d[a]?1:c[a]<d[a]?-1:c[b]>d[b]?1:c[b]<d[b]?-1:0)}function makeFavicon(d,e,f){let a=document.createElement('canvas');a.width=16,a.height=16;let c=a.getContext('2d');c.fillStyle=f,c.fillRect(0,0,16,16);let b=a.getContext("2d");b.fillStyle=e,b.font="bold 12px Arial",b.fillText(d,4,12);let g=document.getElementById("favicon-link");g.href=a.toDataURL("image/x-icon")};let contactsTableElement=document.getElementById("contacts-table"),contactsEditForm=document.getElementById("contacts-edit-form"),contactsEditFormMessage=document.getElementById("contacts-edit-form-message"),contactsSortAscending=1,contactsTable={name:"Contacts",headers:["First Name","Middle Name","Last Name","Mobile Phone","Home Phone","Business Phone","E-mail Address","Home Address","Notes"],inputTypes:{"First Name":"text","Middle Name":"text","Last Name":"text","Mobile Phone":"tel","Home Phone":"tel","Business Phone":"tel","E-mail Address":"email","Home Address":"textarea",Notes:"textarea"},data:[]},calendarTable=document.getElementById("calendar-table"),calendarEditForm=document.getElementById("calendar-edit-form"),calendarEditFormMessage=document.getElementById("calendar-edit-form-message"),monthChooser=document.getElementById("month-chooser"),daysAbbreviations=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],calendarSortAscending=1,calendarDatabase={name:"Calendar",headers:["Subject","Start Date","Start Time","End Date","End Time","Description","UID"],inputTypes:{Subject:"text","Start Date":"date","Start Time":"time","End Date":"date","End Time":"time",Description:"textarea",UID:"text"},data:[]},combinedDatabase={contacts:contactsTable,calendar:calendarDatabase};initializeCalendarApp();function initializeCalendarApp(){monthChooser.addEventListener("input",makeCalendar),monthChooser.addEventListener("change",makeCalendar),monthChooser.value=getTodaysDate().slice(0,-3),console.log(getTodaysDate().slice(0,-3)),makeCalendar()}function processCalendarHome(){makeCalendar(),showPlannerDiv("planner-calendar-start")}function processCalendarCSVClick(){let b=document.getElementById("calendar-date").value,a={};a.data=[];for(let c=0;c<calendarDatabase.data.length;c++)(b===calendarDatabase.data[c]["Start Date"]||b===calendarDatabase.data[c]["End Date"]||b>=calendarDatabase.data[c]["Start Date"]&&b<=calendarDatabase.data[c]["End Date"])&&a.data.push(calendarDatabase.data[c]);a.headers=calendarDatabase.headers,a=JSON.parse(JSON.stringify(a)),a.name="Calendar",processCSVClick(a)}function buildCalendarTableElement(d){let b=calendarDatabase.data,c=[],e=calendarDatabase.headers.length;for(let a=0;a<b.length;a++)if(d===b[a]["Start Date"]||d===b[a]["End Date"]||d>=b[a]["Start Date"]&&d<=b[a]["End Date"]){let d=JSON.parse(JSON.stringify(b[a]));d.intBaseIndex=a,c.push(d)}destructiveDoubleSortAscending(c,"Start Date","Start Time");let a="";a+="<table>",a+="<thead><tr>";for(let b=0;b<e;b++)a+="<th onclick='//sortCalendarByField(this);'>"+calendarDatabase.headers[b]+"</th>";a+="</tr></thead>",a+="<tbody>";for(let b=0;b<c.length;b++){a+="<tr id='calendar-table-row-"+b.toString()+"' onclick=\"selectCalendarEditForm("+c[b].intBaseIndex.toString()+')">';for(let d=0;d<e;d++){let f=calendarDatabase.headers[d];a+="<td><pre>"+c[b][f]+"</pre></td>"}a+="</tr>"}return a+="</tbody>",a}function newCalendarEntry(a){calendarEditFormMessage.innerHTML=document.getElementById("calendar-date").value+": New Entry",calendarEditForm.innerHTML=buildCalendarEditForm(-1),showPlannerDiv("planner-calendar-form")}function selectCalendarEditForm(a){calendarEditFormMessage.innerHTML=document.getElementById("calendar-date").value+": Entry "+a.toString(),calendarEditForm.innerHTML=buildCalendarEditForm(a),showPlannerDiv("planner-calendar-form")}function buildCalendarEditForm(c){let f=document.getElementById("calendar-date").value,g=calendarDatabase.data[c],b="";b+="<form>",b="<input type='hidden' id='calendar-row-index' value='"+c.toString()+"'>";let h=calendarDatabase.headers.length,a=calendarDatabase.headers,e=g,d=calendarDatabase.inputTypes;for(let g=0;g<h;g++){let i="";if(d[a[g]]==="number"?i=" step='any' ":d[a[g]]==="tel"&&(i=" placeholder='304-424-1000' pattern='[0-9]{3}-[0-9]{3}-[0-9]{4}' "),a[g]==="Start Date"&&c===-1&&(i="value="+f),a[g]==="End Date"&&c===-1&&(i="value="+f),a[g]==="UID"&&(i="disabled"),d[a[g]]!=="textarea")console.log("not textarea"),c===-1?b+="<div><label for='"+a[g]+"'>"+a[g]+"</label></div><div><input type='"+d[a[g]]+"' id='"+a[g]+"' "+i+"></div>":b+="<div><label for='"+a[g]+"'>"+a[g]+"</label></div><div><input type='"+d[a[g]]+"' id='"+a[g]+"' value='"+e[a[g]].split('"').join("&quot;").split("'").join("&apos;")+"'"+i+"></div>";else if(console.log("textarea!"),c===-1)b+="<div><label for='"+a[g]+"'>"+a[g]+"</label></div><div><textarea id='"+a[g]+"' "+i+"></textarea></div>";else{let c=e[a[g]].split('"').join("&quot;").split("'").join("&apos;");console.log(c),b+="<div><label for='"+a[g]+"'>"+a[g]+"</label></div><div><textarea id='"+a[g]+"' "+i+">"+c+"</textarea></div>"}}return b+="</form>",b}function saveCalendarEntry(){let c=parseInt(document.getElementById("calendar-row-index").value),d=document.getElementById("calendar-date").value,b=calendarDatabase.headers,a={};for(let c=0;c<b.length;c++)a[b[c]]=document.getElementById(b[c]).value;a["Start Date"]===""&&(a["Start Date"]=d),a["Start Time"]===""&&(a["Start Time"]="00:00"),(a.UID===""||a.UID===void 0)&&(a.UID=makeUID(a["Start Date"],a["Start Time"])),c>=0?calendarDatabase.data[c]=a:calendarDatabase.data.push(a),clearCalendarFormEntries(),calendarTable.innerHTML=buildCalendarTableElement(d),showPlannerDiv("planner-calendar-table"),confirm("Current data updated.  Save updated data to file?")&&saveCombinedDatabase()}function exportSingleICalEvent(){let c=parseInt(document.getElementById("calendar-row-index").value),e=document.getElementById("calendar-date").value,b=calendarDatabase.headers,a={};for(let c=0;c<b.length;c++)a[b[c]]=document.getElementById(b[c]).value;(a.UID===""||a.UID===void 0)&&(a.UID=makeUID(a["Start Date"],a["Start Time"]),document.getElementById("UID").innerHTML=a.UID);let f=makeVEvent(a,"\n"),d=[];d.push(f);let g=makeVCalendar(d,"\n"),h="vEvent"+a["Start Date"]+"_"+a["Start Time"].replace(/\:/g,"");copyAndSaveString(g,h,".ical",mimeType="text/calendar"),c>=0?calendarDatabase.data[c]=a:calendarDatabase.data.push(a),alert("Entry also updated in calendar."),clearCalendarFormEntries(),calendarTable.innerHTML=buildCalendarTableElement(e),showPlannerDiv("planner-calendar-table")}function makeUID(b,c){let d=calendarDatabase.data,e=[];for(let a=0;a<d.length;a++)e.push(d[a].UID);let a="bitOffice."+ISOStringToICalStringZulu(htmlDateAndTimeToISOString(b,c))+Math.random().toString();while(e.includes(a))a="bitOffice."+ISOStringToICalStringZulu(htmlDateAndTimeToISOString(b,c))+Math.random().toString();return a}function purgeCalendar(){}function deleteCalendarEntry(){let a=parseInt(document.getElementById("calendar-row-index").value),b=document.getElementById("calendar-date").value;a>=0&&confirm("Delete this entry?")&&calendarDatabase.data.splice(a,1),clearCalendarFormEntries(),calendarTable.innerHTML=buildCalendarTableElement(b),showPlannerDiv("planner-calendar-table"),confirm("Current data updated.  Save updated data to file?")&&saveCombinedDatabase()}function cancelCalendarEntry(){let a=document.getElementById("calendar-date").value;clearCalendarFormEntries(),calendarTable.innerHTML=buildCalendarTableElement(a),showPlannerDiv("planner-calendar-table")}function clearCalendarFormEntries(){let a=calendarDatabase.headers;for(let b=0;b<a.length;b++)document.getElementById(a[b]).value="";document.getElementById("calendar-row-index").value=-1,calendarEditFormMessage.innerHTML=""}function sortCalendarByField(b){let a=document.getElementById("calendar-date").value,c=b.innerHTML;calendarDatabase.dates[a].data.length>1&&confirm("Sort by "+b.innerHTML+"?")&&(destructiveSort(calendarDatabase.dates[a].data,c,calendarSortAscending),calendarTable.innerHTML=buildCalendarTableElement(a),calendarSortAscending=-1*calendarSortAscending)}function makeCalendar(){console.log("--------------------"),console.log(monthChooser.value),console.log("--------------------");let d=new Date(monthChooser.value+"-01T00:00"),b=d.getDay(),e=parseInt(monthChooser.value.split("-")[1])-1,f=parseInt(monthChooser.value.split("-")[0]),c=daysInSomeMonth(e,f),a="<table>";a+="<tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>",a+="<tr>";for(let c=0;c<b;c++)console.log("x",daysAbbreviations[c]),a+="<td>-</td>";for(let d=0;d<c;d++){let e=d+1,f=daysAbbreviations[(d+b)%7];(d+b)%7===0&&(console.log("--------new line ----------"),a+="</tr><tr>"),a+="<td class='return-calendar-date'>"+(d+1).toString()+"</td>"}let g=(c-1+b)%7,h=6-g;for(let b=0;b<h;b++)a+="<td>-</td>";return a+="</tr></table>",document.getElementById('special-calendar').innerHTML=a,addEventListenersToCalendarEntries(),purgeCalendar(),colorCalendarEntries(),a}function addEventListenersToCalendarEntries(){let a=document.getElementsByClassName('return-calendar-date');for(let b of a)b.addEventListener("click",a=>{openDayEntry(a)})}function openDayEntry(b){let a=monthChooser.value+"-"+("0"+b.target.innerHTML).slice(-2);if(document.getElementById("calendar-date").value=a,a==="")return;document.getElementById("calendar-table-name").innerHTML=daysAbbreviations[getDayOfWeek(a)]+" "+a+"</span>",calendarTable.innerHTML=buildCalendarTableElement(a),showPlannerDiv("planner-calendar-table")}function colorCalendarEntries(){purgeCalendar();let a=document.getElementsByClassName('return-calendar-date');for(let b of a){b.style.backgroundColor="#E0E0E0;";let c=monthChooser.value+"-"+("0"+b.innerHTML).slice(-2);for(let a=0;a<calendarDatabase.data.length;a++)(c===calendarDatabase.data[a]["Start Date"]||c===calendarDatabase.data[a]["End Date"]||c>=calendarDatabase.data[a]["Start Date"]&&c<=calendarDatabase.data[a]["End Date"])&&(b.style.backgroundColor="darkorange");getTodaysDate()===c&&(b.style.border="2px solid black",b.style["font-weight"]="bold")}}function createOutlookCSV(){let a=JSONToCSV(calendarDatabase,!0,"\r\n");console.log(a),copyAndSaveString(a,"plannerToOutlookExport"+getTodaysDate(),".csv","text/csv")}function loadOutlookCSV(){if(confirm("This will add entries to the existing current calendar.\n\nIf you want to over-write all contents, please clear the calendar first, then proceed with loading the data.")){let b="",a=document.createElement('input');a.type="file",a.accept=".csv",a.addEventListener("change",function(){let d=a.files[0],c=new FileReader;c.onload=function(f){b=f.target.result,console.log(b);let e=csvToJSON(b);console.log(e);let c=e.data,a=calendarDatabase.headers,d=e.headers;for(let b=0;b<c.length;b++){let e={};console.log(c[b]);for(let d=0;d<a.length;d++)a[d]==="Start Date"||a[d]==="End Date"?e[a[d]]=outlookDateToPlannerDate(c[b][a[d]]):a[d]==="Start Time"||a[d]==="End Time"?e[a[d]]=outlookTimeToPlannerTime(c[b][a[d]]):e[a[d]]=c[b][a[d]];let f="\nAdditional Information:\n_______________________";for(let a=0;a<d.length;a++)e.hasOwnProperty(d[a])||c[b][d[a]].trim()!==""&&c[b][d[a]].trim()!=="Normal"&&(f+="\n"+d[a]+":"+c[b][d[a]]);f!=="\nAdditional Information:\n_______________________"&&(e.Description+=f.trim(),e.Description=e.Description.trim()),calendarDatabase.data.push(e)}showPlannerDiv("planner-calendar-start"),makeCalendar()},c.readAsText(d,"UTF-8")}),a.click(),console.log("loadOutlookCSV called")}}function outlookDateToPlannerDate(b){let a=b.trim().split("/");if(a.length!==3)return b;let d=("0"+a[0]).slice(-2),e=("0"+a[1]).slice(-2),f=a[2];console.log(b),console.log(a);let c=f+"-"+d+"-"+e;return console.log(c),c}function outlookTimeToPlannerTime(b){let e=!1;b.indexOf("PM")!=-1&&(e=!0);let c=b.split(":");if(!(c.length>=2))return b;let a=c[0],d=parseInt(a);e===!0&&d!==12&&(d+=12),a=d.toString(),a=("0"+a).slice(-2);let f=c[1];return a+":"+f}function clearCalendar(){confirm("Are you sure?  This will clear all calendar entries")&&(calendarDatabase={name:"Calendar",headers:["Subject","Start Date","Start Time","End Date","End Time","Description","UID"],inputTypes:{Subject:"text","Start Date":"date","Start Time":"time","End Date":"date","End Time":"time",Description:"textarea",UID:"text"},data:[]}),makeCalendar()}initializeContactsApp();function initializeContactsApp(){fillInEmptyPropertyValues(contactsTable),contactsTableElement.innerHTML=buildContactsTableElement(contactsTable),contactsEditForm.innerHTML=buildContactsEditForm(contactsTable,-1)}function backupContactsDatabase(){return JSON.parse(JSON.stringify(contactsTable))}function buildContactsTableElement(b){let a="",c=b.headers.length,d=b.data.length;a+="<table>",a+="<thead><tr>";for(let d=0;d<c;d++)a+="<th onclick='sortContactsByField(this);'>"+b.headers[d]+"</th>";a+="</tr></thead>",a+="<tbody>";for(let e=0;e<d;e++){a+="<tr id='contacts-table-row-"+e.toString()+"' onclick='selectContactsEditForm(this)'>";for(let d=0;d<c;d++){let f=b.headers[d];a+="<td><pre>"+b.data[e][f]+"</pre></td>"}a+="</tr>"}return a+="</tbody>",a}function newContactsEntry(){contactsEditFormMessage.innerHTML=contactsTable.name+": New Entry",contactsEditForm.innerHTML=buildContactsEditForm(contactsTable,-1),showPlannerDiv("planner-contacts-form")}function selectContactsEditForm(b){let a=parseInt(b.id.split("-")[3]);contactsEditFormMessage.innerHTML=contactsTable.name+": Entry "+a.toString(),contactsEditForm.innerHTML=buildContactsEditForm(contactsTable,a),showPlannerDiv("planner-contacts-form")}function buildContactsEditForm(d,e){let b="";b+="<form>",b="<input type='hidden' id='contacts-row-index' value='"+e.toString()+"'>";let g=d.headers.length,a=d.headers,f=d.data[e],c=d.inputTypes;for(let d=0;d<g;d++){let h="";if(c[a[d]]==="number"?h=" step='any' ":c[a[d]]==="tel"&&(h=" placeholder='304-424-1000' pattern='[0-9]{3}-[0-9]{3}-[0-9]{4}' "),e===-1)c[a[d]]==="textarea"?b+="<div><label for='contact-"+a[d]+"'>"+a[d]+"</label></div><div><textarea id='contact-"+a[d]+"' "+h+"></textarea></div>":b+="<div><label for='contact-"+a[d]+"'>"+a[d]+"</label></div><div><input type='"+c[a[d]]+"' id='contact-"+a[d]+"' "+h+"></div>";else if(c[a[d]]==="textarea"){let c=f[a[d]].split('"').join("&quot;").split("'").join("&apos;");b+="<div><label for='contact-"+a[d]+"'>"+a[d]+"</label></div><div><textarea id='contact-"+a[d]+"' "+h+">"+c+"</textarea></div>"}else b+="<div><label for='contact-"+a[d]+"'>"+a[d]+"</label></div><div><input type='"+c[a[d]]+"' id='contact-"+a[d]+"' value='"+f[a[d]].split('"').join("&quot;").split("'").join("&apos;")+"'"+h+"></div>"}return b+="</form>",b}function saveContactsEntry(){let c=parseInt(document.getElementById("contacts-row-index").value),a=contactsTable.headers,b={};for(let c=0;c<a.length;c++)b[a[c]]=document.getElementById("contact-"+a[c]).value;c>=0?contactsTable.data[c]=b:contactsTable.data.push(b),clearContactFormEntries(contactsTable),contactsTableElement.innerHTML=buildContactsTableElement(contactsTable),showPlannerDiv("planner-contacts-table"),confirm("Data updated.  Save updated data to file?")&&saveCombinedDatabase()}function exportSingleVCard(){let c=parseInt(document.getElementById("contacts-row-index").value),b=contactsTable.headers,a={};for(let c=0;c<b.length;c++)a[b[c]]=document.getElementById("contact-"+b[c]).value;let d=makeSingleVCFString(a);copyAndSaveString(d,a["First Name"]+"-"+a["Last Name"]+"-"+"Contact"+"-"+getTodaysDate(),".vcf","text/vcard"),c>=0?contactsTable.data[c]=a:contactsTable.data.push(a),alert("Entry also updated in contacts."),clearContactFormEntries(contactsTable),contactsTableElement.innerHTML=buildContactsTableElement(contactsTable),showPlannerDiv("planner-contacts-table")}function deleteContactsEntry(){let a=parseInt(document.getElementById("contacts-row-index").value);a>=0&&confirm("Delete this entry?")&&contactsTable.data.splice(a,1),clearContactFormEntries(contactsTable),contactsTableElement.innerHTML=buildContactsTableElement(contactsTable),showPlannerDiv("planner-contacts-table"),confirm("Current data updated.  Save updated data to file?")&&saveCombinedDatabase()}function cancelContactsEntry(){clearContactFormEntries(contactsTable),contactsTableElement.innerHTML=buildContactsTableElement(contactsTable),showPlannerDiv("planner-contacts-table")}function clearContactFormEntries(b){let a=b.headers;for(let b=0;b<a.length;b++)document.getElementById("contact-"+a[b]).value="";document.getElementById("contacts-row-index").value=-1,contactsEditFormMessage.innerHTML=""}function sortContactsByField(a){let b=a.innerHTML;contactsTable.data.length>1&&confirm("Sort by "+a.innerHTML+"?\n\nThis cannot be undone.")&&(destructiveSort(contactsTable.data,b,contactsSortAscending),contactsTableElement.innerHTML=buildContactsTableElement(contactsTable),contactsSortAscending=-1*contactsSortAscending)}function loadOutlookContactsCSV(){if(confirm("This will merge entries.\n\nIf you want to over-write all contents, please clear the contacts first, then proceed with loading the data.")){let b="",a=document.createElement('input');a.type="file",a.accept=".csv",a.addEventListener("change",function(){let d=a.files[0],c=new FileReader;c.onload=function(f){b=f.target.result,console.log(b);let d=csvToJSON(b);console.log(d);let c=d.data,e=contactsTable.headers,a=d.headers;for(let d=0;d<c.length;d++){let b={};console.log(c[d]);for(let a=0;a<e.length;a++)b[e[a]]=c[d][e[a]];let f="\r\nAdditional Information:\r\n_______________________";for(let e=0;e<a.length;e++)console.log(a[e]),b.hasOwnProperty(a[e])||c[d][a[e]].trim()===""||a[e].trim()==="Categories"||(f+="\r\n"+a[e]+":"+c[d][a[e]],console.log("extra: "+a[e]+"\n"+c[d][a[e]]));f==="\r\nAdditional Information:\r\n_______________________"?b.Notes=b.Notes.trim():(b.Notes=b.Notes.trim(),b.Notes+="\r\n"+f),contactsTable.data.push(b)}contactsTableElement.innerHTML=buildContactsTableElement(contactsTable),showPlannerDiv("planner-contacts-table")},c.readAsText(d,"UTF-8")}),a.click(),console.log("loadOutlookContactsCSV called")}}function saveOutlookContactsCSV(){let a=makeCSV(contactsTable,!0);copyAndSaveString(a,contactsTable.name+getTodaysDate(),".csv","text/csv")}function importVCF(){if(confirm("This will merge entries.\n\nIf you want to over-write all contents, please clear the contacts first, then proceed with loading the data.")){let b="",a=document.createElement('input');a.type="file",a.accept=".vcf",a.addEventListener("change",function(){let d=a.files[0],c=new FileReader;c.onload=function(a){b=a.target.result,readInAllVcards(b),contactsTableElement.innerHTML=buildContactsTableElement(contactsTable),showPlannerDiv("planner-contacts-table")},c.readAsText(d,"UTF-8")}),a.click()}}function importICSCalendar(){if(confirm("This will merge entries.  Continue?")){let b="",a=document.createElement('input');a.type="file",a.accept=".ics",a.addEventListener("change",function(){let d=a.files[0],c=new FileReader;c.onload=function(c){b=c.target.result;let a=getVEVENTSFromICS(b);for(let c=0;c<a.length;c++){let b=parseVEVENTToObject(a[c]);(b.UID===""||b.UID===void 0)&&(b.UID=makeUID(b["Start Date"],b["Start Time"])),calendarDatabase.data.push(b)}showPlannerDiv('planner-calendar-start'),makeCalendar()},c.readAsText(d,"UTF-8")}),a.click()}}function getVEVENTSFromICS(a){a.replace(/(\r\n|\r|\n)/g,"\\\n"),a=a.trim(),lines=a.split("\n");let d=[],b="",c=!1;for(let a=0;a<lines.length;a++)c===!0&&(lines[a].slice(0,10)==="END:VEVENT"?(c=!1,d.push(b),b=""):b+=lines[a]+="\n"),lines[a].slice(0,12)==="BEGIN:VEVENT"&&(c=!0);return d}function parseVEVENTToObject(b){let a={};b=b.replace(/(\r\n|\r|\n)/g,"\n"),b=b.trim();let c=b.split("\n");a.Subject="",a.Description="",a.UID="",a["Start Date"]="",a["Start Time"]="",a["End Date"]="",a["End Time"]="";let d="\n-------Extra Stuff-------\n";for(let e=0;e<c.length;e++){let b=c[e];if(b.slice(0,7)==="SUMMARY")a.Subject=b.split(":")[1];else if(b.slice(0,11)==="DESCRIPTION")a.Description=b.split(":")[1];else if(b.slice(0,3)==="UID")a.UID=b.split(":")[1];else if(b.slice(0,7)==="DTSTART"){let i=b.split(":")[1],j=iCalDateToISOString(i),c=new Date(j),f=c.getFullYear().toString(),g=("0"+(c.getMonth()+1).toString()).slice(-2),h=("0"+c.getDate().toString()).slice(-2),d=("0"+c.getHours().toString()).slice(-2),e=("0"+c.getMinutes().toString()).slice(-2),k=("0"+c.getSeconds().toString()).slice(-2);console.log("year: ",f," month: ",g," date: ",h),console.log("hours: ",d," minutes: ",e," seconds: ",k),a["Start Date"]=f+"-"+g+"-"+h,a["Start Time"]=d+":"+e}else if(b.slice(0,5)==="DTEND"){let d=b.split(":")[1],e=iCalDateToISOString(d),c=new Date(e),f=c.getFullYear().toString(),g=("0"+(c.getMonth()+1).toString()).slice(-2),h=("0"+c.getDate().toString()).slice(-2),i=("0"+c.getHours().toString()).slice(-2),j=("0"+c.getMinutes().toString()).slice(-2),k=("0"+c.getSeconds().toString()).slice(-2);a["End Date"]=f+"-"+g+"-"+h,a["End Time"]=i+":"+j}else d+=b+"\n"}return a.Description+=d,a}function iCalDateToISOString(a){let e=a.slice(0,4),f=a.slice(4,6),g=a.slice(6,8),b="00",c="00",d="00";if(a.indexOf("T")!==-1&&(b=a.slice(9,11),c=a.slice(11,13),d=a.slice(13,15)),a.indexOf("Z")!==-1){let a=e+"-"+f+"-"+g+"T"+b+":"+c+":"+d+".000Z";return a}let h=parseInt(e),i=parseInt(f),j=parseInt(g),k=parseInt(b),l=parseInt(c),m=parseInt(d),n=new Date(h,i-1,j,k,l,m);return n.toISOString()}function readInAllVcards(a){let b=a.indexOf("BEGIN:VCARD"),c=a.indexOf("END:VCARD");while(b!==-1){let d=a.substring(b,c+9),e=parseContactFromVCard(d);contactsTable.data.push(e),b=a.indexOf("BEGIN:VCARD",c),c=a.indexOf("END:VCARD",b+1)}}function parseContactFromVCard(d){d=d.trim(),d=d.replace(/;PREF/g,""),d=d.replace(/;VOICE/g,";HOME"),d=d.replace(/\r\n|\n|\r/gm,"\n");let a=d.split("\n"),c=["ADR;HOME:","EMAIL:","FN:","NOTE:","TEL;CELL:","TEL;HOME:","TEL;WORK:","N:"],g=["Home Address","E-mail Address","First Name","Notes","Mobile Phone","Home Phone","Business Phone","Last Name","Middle Name"],b={};for(let d=0;d<c.length;d++)for(j=0;j<a.length;j++)if(console.log(a[j].substring(0,3)),a[j].substring(0,3)==="TEL"&&(console.log("FOUND TEL!!!!"),a[j].indexOf("CELL")!==-1&&(console.log("Contains CELL"),b["Mobile Phone"]=a[j].split(":")[1]),a[j].indexOf("HOME")!==-1&&(console.log("Contains HOME"),b["Home Phone"]=a[j].split(":")[1]),a[j].indexOf("WORK")!==-1&&(console.log("Contains WORK"),b["Business Phone"]=a[j].split(":")[1])),a[j].substring(0,c[d].length)===c[d])if(c[d]==="N:"){let e=a[j].substring(c[d].length).split(";")[0];b["Last Name"]=e;let f=a[j].substring(c[d].length).split(";")[2];b["Middle Name"]=f;let g=a[j].substring(c[d].length).split(";")[1];b["First Name"]=g}else console.log("found match for ",c[d]),b[g[d]]=a[j].substring(c[d].length);let f=contactsTable.headers;for(let a=0;a<f.length;a++)b.hasOwnProperty(f[a])||(b[f[a]]="");let e=["ADR","AGENT","ANNIVERSARY","BDAY","CALADRURI","CALURI","CATEGORIES","CLASS","CLIENTPIDMAP","FBURL","GENDER","GEO","IMPP","KEY","KIND","LABEL","LANG","MAILER","MEMBER","NAME","NICKNAME","ORG","PRODID","PROFILE","RELATED","REV","ROLE","SORT-STRING","SOURCE","TEL","TITLE","TZ","UID","URL","XML"];for(let d=0;d<a.length;d++)if(c.includes(a[d].split(":")[0]+":"));else for(j=0;j<e.length;j++)a[d].substring(0,e[j].length)===e[j]&&(console.log("found extra ",e[j]),b.Notes+="\n"+e[j]+a[d].substring(e[j].length));return b}function exportVCF(){let a="",b=contactsTable.data;for(let c=0;c<b.length;c++)a+=makeSingleVCFString(b[c]);console.log(a),copyAndSaveString(a,"vcf"+contactsTable.name+getTodaysDate(),".vcf","text/vcard")}function makeSingleVCFString(a){let b="";console.log(a),b+="BEGIN:VCARD\n",b+="VERSION:2.1\n";let c="",d="",e="";return a["Last Name"]!==void 0&&(c=a["Last Name"],c=c.replace(/\;/g," ")),a["First Name"]!==void 0&&(d=a["First Name"],d=d.replace(/\;/g," ")),a["Middle Name"]!==void 0&&(e=a["Middle Name"],e=e.replace(/\;/g," ")),b+="N:"+c+";"+d+";"+e+";;\n",b+="FN:"+d+" "+e+" "+c+"\n",a["Mobile Phone"]!==void 0&&a["Mobile Phone"]!==""&&(b+="TEL;CELL:"+a["Mobile Phone"]+"\n"),a["Home Phone"]!==void 0&&a["Home Phone"]!==""&&(b+="TEL;HOME:"+a["Home Phone"]+"\n"),a["Business Phone"]!==void 0&&a["Business Phone"]!==""&&(b+="TEL;WORK:"+a["Business Phone"]+"\n"),a["E-mail Address"]!==void 0&&a["E-mail Address"]!==""&&(b+="EMAIL:"+a["E-mail Address"]+"\n"),a["Home Address"]!==void 0&&a["Home Address"]!==""&&(b+="ADR;HOME:"+a["Home Address"]+"\n"),a.Notes!==void 0&&a.Notes!==""&&(b+="NOTE:"+a.Notes+"\n"),b+="END:VCARD\n",b}function showPlannerDiv(a){let b=document.getElementsByClassName('planner-div');for(let a of b)a.style.display="none";document.getElementById(a).style.display="unset"}function backHomePlanner(){showPlannerDiv("planner-home"),document.getElementById("planner-ribbon").style.display="flex",document.getElementById("back-home-nav").style.display="none"}function loadCombinedDatabase(){let b="",a=document.createElement('input');a.type="file",a.accept=".json",a.addEventListener("change",function(){let d=a.files[0],c=new FileReader;c.onload=function(c){b=c.target.result,combinedDatabase=JSON.parse(b),contactsTable=combinedDatabase.contacts,calendarDatabase=combinedDatabase.calendar,calendarDatabase.headers.includes("UID")||(calendarDatabase.headers.push("UID"),calendarDatabase.inputTypes.UID="text");let a=calendarDatabase.data;for(let b=0;b<a.length;b++)(a[b].UID===""||a[b].UID===void 0)&&(a[b].UID=makeUID(a["Start Date"],a["Start Time"]));clearContactFormEntries(contactsTable),contactsTableElement.innerHTML=buildContactsTableElement(contactsTable),makeCalendar(),showPlannerDiv('planner-calendar-start')},c.readAsText(d,"UTF-8")}),a.click()}function saveCombinedDatabase(){purgeCalendar();let a=JSON.stringify(combinedDatabase),b="bitOfficePlanner"+getTodaysDate();saveStringToTextFile(a,b,".json","application/json")}function makeVEvent(a,j="\n"){let b=j;str="";let i=a.Subject,d=a["Start Date"],g=a.UID;if(d===""||d===void 0)return;let c=a["Start Time"];(c===""||c===void 0)&&(c="00:00");let e=a["End Date"];(e===""||e===void 0)&&(e=d);let f=a["End Time"];(f===""||f===void 0)&&(f=c),(g===""||g===void 0)&&(g=makeUID(d,c));let k=a.Description,l=new Date,h=l.toISOString();return h=ISOStringToICalStringZulu(h),str+="BEGIN:VEVENT"+b,str+="SUMMARY:"+i.trim()+b,rowDateTimeToICALString(d,c),rowDateTimeToICALString(e,f),str+="DTSTART:"+rowDateTimeToICALString(d,c).trim()+b,str+="DTEND:"+rowDateTimeToICALString(e,f).trim()+b,str+="DESCRIPTION:"+k.trim()+b,str+="DTSTAMP:"+h.trim()+b,str+="UID:"+g.trim()+b,str+="END:VEVENT",str}function rowDateTimeToICALString(a,b){let c=htmlDateAndTimeToISOString(a,b),d=ISOStringToICalStringZulu(c);return d;return console.log("fromhtml:"),icalStr=a.split("-").join("")+"T"+b.split(":").join(""),console.log(icalStr),icalStr}function htmlDateAndTimeToISOString(b="2023-01-31",a){(a===""||a===void 0)&&(a="00:00");let d=parseInt(b.slice(0,4)),e=parseInt(b.slice(5,7))-1,f=parseInt(b.slice(8)),g=parseInt(a.slice(0,2)),h=parseInt(a.slice(3)),c=new Date(d,e,f,g,h);return console.log("html date and time to iso string here !!!!",c.toISOString()),c.toISOString()}function ISOStringToICalStringZulu(a){let b=a.replace(/\.\d\d\dZ/,"Z").replace(/\-|\:|\./g,"");return b}function makeVEventsArr(a){let b=[];for(let c=0;c<a.length;c++)b.push(makeVEvent(a[c]).trim());return b}function makeVCalendar(c,d="\n"){let a="",b=d;a+="BEGIN:VCALENDAR"+b,a+="VERSION:2.0"+b,a+="PRODID:bitOffice"+b,a+="CALSCALE:GREGORIAN"+b;for(let d=0;d<c.length;d++)a+=c[d].trim()+b;return a+="END:VCALENDAR",a}function exportICSCalendar(){let a=makeVEventsArr(calendarDatabase.data),b=makeVCalendar(a);copyAndSaveString(b,"ICSCalendar"+getTodaysDate(),".ics","text/calendar")}function removeDuplicateContacts(){let a=contactsTable.data.length;console.log("BEFORE"),console.log("number of contacts is: "+a.toString());let b=contactsTable.data,c=[];for(let a=0;a<b.length;a++)isObjectInArray(c,b[a])||c.push(b[a]);contactsTable.data=JSON.parse(JSON.stringify(c)),contactsTableElement.innerHTML=buildContactsTableElement(contactsTable);let d=contactsTable.data.length;console.log("AFTER"),console.log("number of contacts is: "+d.toString()),console.log((a-d).toString()+" duplicate(s) removed."),alert((a-d).toString()+" duplicate(s) removed.")}function isObjectInArray(a,b){for(let c=0;c<a.length;c++)if(doObjectsHaveSameKeysAndProperties(a[c],b))return!0;return!1}function doObjectsHaveSameKeysAndProperties(c,d){let a=Object.keys(c),b=Object.keys(d);if(a.length!==b.length)return!1;for(let b=0;b<a.length;b++)if(c[a[b]]!==d[a[b]])return!1;for(let a=0;a<b.length;a++)if(d[b[a]]!==c[b[a]])return!1;return!0}let nestedMenues=document.getElementsByClassName("nested-menu");for(let a of nestedMenues)a.addEventListener("click",a=>{toggleNest(a.target)});function toggleNest(a){let b=a.parentElement.children;for(let c of b)c===a||(c.style.display==="none"?c.style.display="inherit":c.style.display="none")}function toggleAll(){for(let a of nestedMenues)toggleNest(a)}function openSelectedInitialNests(){for(let a of nestedMenues)a.classList.contains("initial-open")&&toggleNest(a)}toggleAll(),openSelectedInitialNests();</script><script>let selfString="";function createSelf(){let a=document.getElementsByTagName("html")[0].innerHTML;selfString+="<!DOCTYPE html><html lang='en'>"+a+"</html>"}window.onload=createSelf();makeFavicon("p", "white", "mediumblue");
window.onbeforeunload = askConfirm;
document.getElementById("top-nav").style.display="none";
showPlannerDiv('planner-load');
showMain('main-planner');

;</script></body>
</html>